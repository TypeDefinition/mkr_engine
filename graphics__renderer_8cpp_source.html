<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>mkr_engine: src/graphics/renderer/graphics_renderer.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">mkr_engine
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_560415a5d2bc4999842279f4fc1debef.html">graphics</a></li><li class="navelem"><a class="el" href="dir_3be91838934054dc8688592bc1b65481.html">renderer</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">graphics_renderer.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="graphics__renderer_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="preprocessor">#include &lt;GL/glew.h&gt;</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="preprocessor">#include &lt;SDL2/SDL.h&gt;</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="preprocessor">#include &lt;log/log.h&gt;</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="graphics__renderer_8h.html">graphics/renderer/graphics_renderer.h</a>&quot;</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="texture__unit_8h.html">graphics/shader/texture_unit.h</a>&quot;</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="shadow__2d__shader_8h.html">graphics/shader/shadow_2d_shader.h</a>&quot;</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="shadow__cubemap__shader_8h.html">graphics/shader/shadow_cubemap_shader.h</a>&quot;</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="geometry__shader_8h.html">graphics/shader/geometry_shader.h</a>&quot;</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="lighting__shader_8h.html">graphics/shader/lighting_shader.h</a>&quot;</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="forward__shader_8h.html">graphics/shader/forward_shader.h</a>&quot;</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="alpha__weight__shader_8h.html">graphics/shader/alpha_weight_shader.h</a>&quot;</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="alpha__blend__shader_8h.html">graphics/shader/alpha_blend_shader.h</a>&quot;</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="skybox__shader_8h.html">graphics/shader/skybox_shader.h</a>&quot;</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="post__proc__shader_8h.html">graphics/shader/post_proc_shader.h</a>&quot;</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="mesh__builder_8h.html">graphics/mesh/mesh_builder.h</a>&quot;</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="shadow__bounds_8h.html">graphics/shadow/shadow_bounds.h</a>&quot;</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160; </div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="keyword">namespace </span><a class="code" href="namespacemkr.html">mkr</a> {</div>
<div class="line"><a name="l00019"></a><span class="lineno"><a class="line" href="classmkr_1_1graphics__renderer.html#a50b03b55fb625d4f702b45e07aa43c1a">   19</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classmkr_1_1graphics__renderer.html#a50b03b55fb625d4f702b45e07aa43c1a">graphics_renderer::init</a>() {</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;        <span class="comment">// Initialise SDL video subsystem.</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;        <span class="keywordflow">if</span> (0 != SDL_InitSubSystem(SDL_INIT_VIDEO)) {</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;            <span class="keyword">const</span> std::string err_msg = <span class="stringliteral">&quot;SDL_INIT_VIDEO failed&quot;</span>;</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;            mkr::log::error(err_msg);</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;            <span class="keywordflow">throw</span> std::runtime_error(err_msg);</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;        }</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160; </div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;        <span class="comment">// Enable Multisampling</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;        SDL_SetHint(SDL_HINT_RENDER_SCALE_QUALITY, <span class="stringliteral">&quot;1&quot;</span>);</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160; </div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;        <span class="comment">// Set Double Buffering</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;        SDL_GL_SetAttribute(SDL_GL_DOUBLEBUFFER, 1);</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160; </div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;        <span class="comment">// Set OpenGL Version</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;        SDL_GL_SetAttribute(SDL_GL_CONTEXT_MAJOR_VERSION, 4);</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;        SDL_GL_SetAttribute(SDL_GL_CONTEXT_MINOR_VERSION, 6);</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;        <span class="keywordtype">int</span> majorVersion, minorVersion;</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;        SDL_GL_GetAttribute(SDL_GL_CONTEXT_MAJOR_VERSION, &amp;majorVersion);</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;        SDL_GL_GetAttribute(SDL_GL_CONTEXT_MINOR_VERSION, &amp;minorVersion);</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;        mkr::log::info(<span class="stringliteral">&quot;OpenGL Version: {}.{}&quot;</span>, majorVersion, minorVersion);</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160; </div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;        <span class="comment">// Create Window</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;        <a class="code" href="classmkr_1_1graphics__renderer.html#ad8e80c6c3a0fd1a804208f41c32b51f5">app_window_</a> = std::make_unique&lt;app_window&gt;(<span class="stringliteral">&quot;mkr_engine&quot;</span>, <a class="code" href="classmkr_1_1graphics__renderer.html#abbcbdce247815fedf2ee671e88192a34">window_width_</a>, <a class="code" href="classmkr_1_1graphics__renderer.html#aea08e104db3efd807eb0a72f17fd7082">window_height_</a>, <a class="code" href="namespacemkr.html#a9655959a225d822da5e035327fbdb9bdadea58969a0734fca7a7a962adeb02da3">window_flags::none</a>);</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160; </div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;        <span class="comment">// Initialise glew.</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;        <span class="keywordflow">if</span> (GLEW_OK != glewInit()) {</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;            <span class="keywordflow">throw</span> std::runtime_error(<span class="stringliteral">&quot;glewInit failed&quot;</span>);</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;        }</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160; </div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;        <a class="code" href="classmkr_1_1graphics__renderer.html#a85cf3d5b1696d91c74afda9703abf354">skybox_cube_</a> = <a class="code" href="classmkr_1_1mesh__builder.html#ac38c3807cf8fc57625fb610cf7839f06">mesh_builder::make_skybox</a>(<span class="stringliteral">&quot;skybox&quot;</span>);</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;        <a class="code" href="classmkr_1_1graphics__renderer.html#a5a1d94db42b966794e8177cdf2515c48">screen_quad_</a> = <a class="code" href="classmkr_1_1mesh__builder.html#a755d646cc88bda260d2766c18cad1c64">mesh_builder::make_screen_quad</a>(<span class="stringliteral">&quot;screen_quad&quot;</span>);</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160; </div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;        <span class="comment">// Framebuffers</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;        <span class="keywordflow">for</span> (<span class="keyword">auto</span> i = 0; i &lt; <a class="code" href="classmkr_1_1lighting.html#a1d2c15e1eaa3c8162a4a6773a9be5d4e">lighting::max_lights</a>; ++i) {</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;            <a class="code" href="classmkr_1_1graphics__renderer.html#a59ae33da60e332c8a6de4ea65ed8937e">s2d_buff_</a>[i] = std::make_unique&lt;shadow_2d_buffer&gt;(4096);</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;            <a class="code" href="classmkr_1_1graphics__renderer.html#a3dbb1e5e1ad7620aaa5361aadb891637">scube_buff_</a>[i] = std::make_unique&lt;shadow_cubemap_buffer&gt;(2048);</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;        }</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160; </div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;        <a class="code" href="classmkr_1_1graphics__renderer.html#afa7c11f1aedc94b816a01e5ed5affeb2">g_buff_</a> = std::make_unique&lt;geometry_buffer&gt;(<a class="code" href="classmkr_1_1graphics__renderer.html#ad8e80c6c3a0fd1a804208f41c32b51f5">app_window_</a>-&gt;width(), <a class="code" href="classmkr_1_1graphics__renderer.html#ad8e80c6c3a0fd1a804208f41c32b51f5">app_window_</a>-&gt;height());</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;        <a class="code" href="classmkr_1_1graphics__renderer.html#aa2de2e0108508425cf4a68f549e1d377">l_buff_</a> = std::make_unique&lt;lighting_buffer&gt;(<a class="code" href="classmkr_1_1graphics__renderer.html#ad8e80c6c3a0fd1a804208f41c32b51f5">app_window_</a>-&gt;width(), <a class="code" href="classmkr_1_1graphics__renderer.html#ad8e80c6c3a0fd1a804208f41c32b51f5">app_window_</a>-&gt;height());</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;        <a class="code" href="classmkr_1_1graphics__renderer.html#a901ae3acb341793861c91c306402b0d6">f_buff_</a> = std::make_unique&lt;forward_buffer&gt;(<a class="code" href="classmkr_1_1graphics__renderer.html#ad8e80c6c3a0fd1a804208f41c32b51f5">app_window_</a>-&gt;width(), <a class="code" href="classmkr_1_1graphics__renderer.html#ad8e80c6c3a0fd1a804208f41c32b51f5">app_window_</a>-&gt;height());</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160; </div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;        <a class="code" href="classmkr_1_1graphics__renderer.html#af195e60ae026f50df4fdf76b73c852f9">a_buff_</a> = std::make_unique&lt;alpha_buffer&gt;(<a class="code" href="classmkr_1_1graphics__renderer.html#ad8e80c6c3a0fd1a804208f41c32b51f5">app_window_</a>-&gt;width(), <a class="code" href="classmkr_1_1graphics__renderer.html#ad8e80c6c3a0fd1a804208f41c32b51f5">app_window_</a>-&gt;height());</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    }</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160; </div>
<div class="line"><a name="l00065"></a><span class="lineno"><a class="line" href="classmkr_1_1graphics__renderer.html#a12b13a3af206a9d6ef1c3aed35910b0b">   65</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classmkr_1_1graphics__renderer.html#a12b13a3af206a9d6ef1c3aed35910b0b">graphics_renderer::start</a>() {</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;        glEnable(GL_MULTISAMPLE);</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;        glEnable(GL_CULL_FACE);</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160; </div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;        <span class="comment">// Depth</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;        glEnable(GL_DEPTH_TEST);</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;        glDepthMask(GL_TRUE);</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;        glDepthFunc(GL_LESS);</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160; </div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;        <span class="comment">// Blend</span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;        glEnable(GL_BLEND);</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;        glBlendFunc(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA);</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160; </div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;        <span class="comment">// Stencil</span></div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;        <span class="comment">// glEnable(GL_STENCIL_TEST);</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;        <span class="comment">// glStencilMask(0xFF); // Each bit is written to the stencil buffer as-is.</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;        <span class="comment">// glDisable(GL_STENCIL_TEST);</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;        <span class="comment">// glStencilMask(0x00);</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    }</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160; </div>
<div class="line"><a name="l00085"></a><span class="lineno"><a class="line" href="classmkr_1_1graphics__renderer.html#a45bd8744927b027b02c65dfe28a5aff3">   85</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classmkr_1_1graphics__renderer.html#a45bd8744927b027b02c65dfe28a5aff3">graphics_renderer::update</a>() {</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;        <span class="comment">// Render</span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;        <a class="code" href="classmkr_1_1graphics__renderer.html#a9bfd2cde07bcbf5414359b7411fb66de">render</a>();</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160; </div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;        <span class="comment">// Swap buffer.</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;        <a class="code" href="classmkr_1_1graphics__renderer.html#ad8e80c6c3a0fd1a804208f41c32b51f5">app_window_</a>-&gt;swap_buffers();</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    }</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160; </div>
<div class="line"><a name="l00093"></a><span class="lineno"><a class="line" href="classmkr_1_1graphics__renderer.html#a99ec397776d7d22c2ad225d9c73e5e98">   93</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classmkr_1_1graphics__renderer.html#a99ec397776d7d22c2ad225d9c73e5e98">graphics_renderer::exit</a>() {</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;        SDL_QuitSubSystem(SDL_INIT_VIDEO);</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    }</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160; </div>
<div class="line"><a name="l00097"></a><span class="lineno"><a class="line" href="classmkr_1_1graphics__renderer.html#a9bfd2cde07bcbf5414359b7411fb66de">   97</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classmkr_1_1graphics__renderer.html#a9bfd2cde07bcbf5414359b7411fb66de">graphics_renderer::render</a>() {</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;        <span class="comment">// Shadow maps for spot and point lights can be shared between cameras.</span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;        <span class="keyword">const</span> <span class="keyword">auto</span> num_lights = maths_util::min&lt;int32_t&gt;(<a class="code" href="classmkr_1_1graphics__renderer.html#abb759c34beb9aaecf69842a174b64ad0">lights_</a>.size(), <a class="code" href="classmkr_1_1lighting.html#a1d2c15e1eaa3c8162a4a6773a9be5d4e">lighting::max_lights</a>);</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;        <span class="keywordflow">for</span> (<span class="keyword">auto</span> i = 0; i &lt; num_lights; ++i) {</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;            <span class="keyword">const</span> <span class="keyword">auto</span>&amp; <a class="code" href="classmkr_1_1light.html">light</a> = <a class="code" href="classmkr_1_1graphics__renderer.html#abb759c34beb9aaecf69842a174b64ad0">lights_</a>[i].light_;</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;            <span class="keyword">const</span> <span class="keyword">auto</span>&amp; trans = <a class="code" href="classmkr_1_1graphics__renderer.html#abb759c34beb9aaecf69842a174b64ad0">lights_</a>[i].transform_;</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="classmkr_1_1light.html">light</a>.<a class="code" href="classmkr_1_1light.html#a2cb6e41279292e9fe1f068408280b191">get_mode</a>() == <a class="code" href="namespacemkr.html#a898cbea13b10a6143c2faf35f4a0fbc2ac895ec5b78e7a9170494460bc36e10a8">light_mode::point</a>) {</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;                <a class="code" href="classmkr_1_1graphics__renderer.html#a3399e8c52b940298b171e96da149ba0d">light_view_projection_matrix_</a>[i] = <a class="code" href="classmkr_1_1graphics__renderer.html#a28c9b6891e064af8a13c42483e6310c9">point_shadow</a>(<a class="code" href="classmkr_1_1graphics__renderer.html#a3dbb1e5e1ad7620aaa5361aadb891637">scube_buff_</a>[i].get(), trans, <a class="code" href="classmkr_1_1light.html">light</a>);</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;            }</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classmkr_1_1light.html">light</a>.<a class="code" href="classmkr_1_1light.html#a2cb6e41279292e9fe1f068408280b191">get_mode</a>() == <a class="code" href="namespacemkr.html#a898cbea13b10a6143c2faf35f4a0fbc2a38e292da519d45e010738205cd347395">light_mode::spot</a>) {</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;                <a class="code" href="classmkr_1_1graphics__renderer.html#a3399e8c52b940298b171e96da149ba0d">light_view_projection_matrix_</a>[i] = <a class="code" href="classmkr_1_1graphics__renderer.html#ad5faef12b92a2717febc17b9cfe700b7">spot_shadow</a>(<a class="code" href="classmkr_1_1graphics__renderer.html#a59ae33da60e332c8a6de4ea65ed8937e">s2d_buff_</a>[i].get(), trans, <a class="code" href="classmkr_1_1light.html">light</a>);</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;            }</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;        }</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160; </div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;        <span class="comment">// Render the scene once for every camera.</span></div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;        <span class="keywordflow">while</span> (!<a class="code" href="classmkr_1_1graphics__renderer.html#a4ef270cde6f2290dc4fb80ebaa82a0bf">cameras_</a>.empty()) {</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;            <span class="keyword">auto</span>&amp; cam = <a class="code" href="classmkr_1_1graphics__renderer.html#a4ef270cde6f2290dc4fb80ebaa82a0bf">cameras_</a>.top().camera_;</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;            <span class="keyword">auto</span>&amp; trans = <a class="code" href="classmkr_1_1graphics__renderer.html#a4ef270cde6f2290dc4fb80ebaa82a0bf">cameras_</a>.top().transform_;</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160; </div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;            <span class="comment">// Shadow maps for directional lights need to be recalculated once for each camera.</span></div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;            <span class="keywordflow">for</span> (<span class="keyword">auto</span> i = 0; i &lt; num_lights; ++i) {</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;                <span class="keyword">const</span> <span class="keyword">auto</span>&amp; <a class="code" href="classmkr_1_1light.html">light</a> = <a class="code" href="classmkr_1_1graphics__renderer.html#abb759c34beb9aaecf69842a174b64ad0">lights_</a>[i].light_;</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="classmkr_1_1light.html">light</a>.<a class="code" href="classmkr_1_1light.html#a2cb6e41279292e9fe1f068408280b191">get_mode</a>() == <a class="code" href="namespacemkr.html#a898cbea13b10a6143c2faf35f4a0fbc2a291534b609849353584a7552c8a44335">light_mode::directional</a>) {</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;                    <a class="code" href="classmkr_1_1graphics__renderer.html#a3399e8c52b940298b171e96da149ba0d">light_view_projection_matrix_</a>[i] = <a class="code" href="classmkr_1_1graphics__renderer.html#a03b093c17c37fada37b9ddda4fdfd027">directional_shadow</a>(<a class="code" href="classmkr_1_1graphics__renderer.html#a59ae33da60e332c8a6de4ea65ed8937e">s2d_buff_</a>[i].get(), <a class="code" href="classmkr_1_1graphics__renderer.html#abb759c34beb9aaecf69842a174b64ad0">lights_</a>[i].transform_, <a class="code" href="classmkr_1_1light.html">light</a>, trans, cam);</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;                }</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;            }</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160; </div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;            <span class="comment">// In OpenGL convention, the camera looks down the -z axis.</span></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;            <span class="keyword">const</span> <span class="keyword">auto</span>&amp; view_dir_x = -trans.left_;</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;            <span class="keyword">const</span> <span class="keyword">auto</span>&amp; view_dir_y = trans.up_;</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;            <span class="keyword">const</span> <span class="keyword">auto</span>&amp; view_dir_z = -trans.forward_;</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160; </div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;            <span class="comment">// View Matrix</span></div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;            <span class="keyword">const</span> <span class="keyword">auto</span> view_matrix = matrix_util::view_matrix(trans.position_, trans.forward_, trans.up_);</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;            <span class="keyword">const</span> <span class="keyword">auto</span> inv_view_matrix = matrix_util::inverse_matrix(view_matrix).value_or(matrix4x4::identity());</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160; </div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;            <span class="comment">// Projection Matrix</span></div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;            <span class="keyword">const</span> <span class="keyword">auto</span> projection_matrix = (cam.mode_ == <a class="code" href="namespacemkr.html#aac2a3034ca6bac134bc3f4f42a31e076a75c6a0985bbb6ec81d99cbb52ff86c1d">projection_mode::perspective</a>)</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;                                           ? matrix_util::perspective_matrix(cam.aspect_ratio_, cam.fov_, cam.near_plane_, cam.far_plane_)</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;                                           : matrix_util::orthographic_matrix(cam.aspect_ratio_, cam.ortho_size_, cam.near_plane_, cam.far_plane_);</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160; </div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160; </div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;            <span class="comment">// Render passes.</span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;            <a class="code" href="classmkr_1_1graphics__renderer.html#aab27889f37c8c7661c5ade22f1b88e0b">geometry_pass</a>(view_matrix, projection_matrix);</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;            <a class="code" href="classmkr_1_1graphics__renderer.html#a57ff6c77dfaea39eeb2716d18fa8a18c">lighting_pass</a>(view_matrix, inv_view_matrix, view_dir_x, view_dir_y, view_dir_z);</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;            <a class="code" href="classmkr_1_1graphics__renderer.html#aeb05b71134e3b598496187bf4d659e78">forward_pass</a>(view_matrix, projection_matrix, inv_view_matrix, view_dir_x, view_dir_y, view_dir_z);</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;            <a class="code" href="classmkr_1_1graphics__renderer.html#af2ead439d01fcef7f72eae69e3242d5b">skybox_pass</a>(matrix_util::view_matrix(vector3::zero(), trans.forward_, trans.up_), projection_matrix, &amp;cam.skybox_);</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;            <a class="code" href="classmkr_1_1graphics__renderer.html#a4cfea9b043d9434c6ff483f7b99d2d9c">alpha_weight_pass</a>(view_matrix, projection_matrix, inv_view_matrix, view_dir_x, view_dir_y, view_dir_z);</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;            <a class="code" href="classmkr_1_1graphics__renderer.html#a937769fc36ea98e5c5a68bba42798587">alpha_blend_pass</a>(view_matrix, projection_matrix);</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160; </div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;            <span class="comment">// Blit result to default framebuffer.</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;            <a class="code" href="classmkr_1_1framebuffer.html#aaa795cc358720ae8a4d6c756952cc032">framebuffer::bind_default_buffer</a>();</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;            <a class="code" href="classmkr_1_1framebuffer.html#af2a2e110301c80169d7c5ff648b5de06">framebuffer::clear_default_buffer_colour</a>();</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;            <a class="code" href="classmkr_1_1framebuffer.html#abec99a4f107c5a285082fa59ea3dab59">framebuffer::clear_default_depth_stencil</a>();</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160; </div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;            <a class="code" href="classmkr_1_1graphics__renderer.html#a901ae3acb341793861c91c306402b0d6">f_buff_</a>-&gt;set_read_colour_attachment(forward_buffer::colour_attachments::colour);</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;            <a class="code" href="classmkr_1_1graphics__renderer.html#a901ae3acb341793861c91c306402b0d6">f_buff_</a>-&gt;blit_to(<span class="keyword">nullptr</span>, <span class="keyword">true</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, 0, 0, <a class="code" href="classmkr_1_1graphics__renderer.html#a901ae3acb341793861c91c306402b0d6">f_buff_</a>-&gt;width(), <a class="code" href="classmkr_1_1graphics__renderer.html#a901ae3acb341793861c91c306402b0d6">f_buff_</a>-&gt;height(), 0, 0, <a class="code" href="classmkr_1_1graphics__renderer.html#ad8e80c6c3a0fd1a804208f41c32b51f5">app_window_</a>-&gt;width(), <a class="code" href="classmkr_1_1graphics__renderer.html#ad8e80c6c3a0fd1a804208f41c32b51f5">app_window_</a>-&gt;height());</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160; </div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;            <span class="comment">// Pop camera off the priority queue.</span></div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;            <a class="code" href="classmkr_1_1graphics__renderer.html#a4ef270cde6f2290dc4fb80ebaa82a0bf">cameras_</a>.pop();</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;        }</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160; </div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;        <span class="comment">// Clear objects for next frame.</span></div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;        <a class="code" href="classmkr_1_1graphics__renderer.html#abb759c34beb9aaecf69842a174b64ad0">lights_</a>.clear();</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;        <a class="code" href="classmkr_1_1graphics__renderer.html#a43a2edd7a4f1420853e119ca87e3c084">deferred_meshes_</a>.clear();</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;        <a class="code" href="classmkr_1_1graphics__renderer.html#a59742a9742830bf3076ea959fc754ef2">forward_meshes_</a>.clear();</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;        <a class="code" href="classmkr_1_1graphics__renderer.html#aacb1c077166c9db226cbee3b901eee1d">transparent_meshes_</a>.clear();</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    }</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160; </div>
<div class="line"><a name="l00166"></a><span class="lineno"><a class="line" href="classmkr_1_1graphics__renderer.html#a28c9b6891e064af8a13c42483e6310c9">  166</a></span>&#160;    matrix4x4 <a class="code" href="classmkr_1_1graphics__renderer.html#a28c9b6891e064af8a13c42483e6310c9">graphics_renderer::point_shadow</a>(<a class="code" href="classmkr_1_1shadow__cubemap__buffer.html">shadow_cubemap_buffer</a>* _buffer, <span class="keyword">const</span> <a class="code" href="structmkr_1_1local__to__world.html">local_to_world</a>&amp; _trans, <span class="keyword">const</span> <a class="code" href="classmkr_1_1light.html">light</a>&amp; _light) {</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;        glDisable(GL_BLEND);</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;        glEnable(GL_DEPTH_TEST);</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;        glDepthMask(GL_TRUE);</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;        glDepthFunc(GL_LESS);</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;        glViewport(0, 0, _buffer-&gt;<a class="code" href="classmkr_1_1framebuffer.html#a655ac6cb85a26d0ee4f842b098268b57">width</a>(), _buffer-&gt;<a class="code" href="classmkr_1_1framebuffer.html#a5e6c6bffac007288e732c099526e66ff">height</a>());</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160; </div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;        _buffer-&gt;<a class="code" href="classmkr_1_1framebuffer.html#aa0c848e4bbe22fbd7c9772fa86c9e244">bind</a>();</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;        _buffer-&gt;<a class="code" href="classmkr_1_1framebuffer.html#ae4ed1d1cf196d0f5da5723b8b8b8c0ca">clear_depth_stencil</a>();</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160; </div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;        matrix4x4 projection_matrix = matrix_util::perspective_matrix(1.0f, maths_util::pi / 2.0f, 0.05f, 50.0f);</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;        matrix4x4 view_projection_matrices[6] = {</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;            projection_matrix * matrix_util::view_matrix(_trans.<a class="code" href="structmkr_1_1local__to__world.html#aa25ce595f7bf081bd02ee2e1faa2bd63">position_</a>, vector3::left(), vector3::down()),</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;            projection_matrix * matrix_util::view_matrix(_trans.<a class="code" href="structmkr_1_1local__to__world.html#aa25ce595f7bf081bd02ee2e1faa2bd63">position_</a>, vector3::right(), vector3::down()),</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;            projection_matrix * matrix_util::view_matrix(_trans.<a class="code" href="structmkr_1_1local__to__world.html#aa25ce595f7bf081bd02ee2e1faa2bd63">position_</a>, vector3::up(), vector3::forwards()),</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;            projection_matrix * matrix_util::view_matrix(_trans.<a class="code" href="structmkr_1_1local__to__world.html#aa25ce595f7bf081bd02ee2e1faa2bd63">position_</a>, vector3::down(), vector3::backwards()),</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;            projection_matrix * matrix_util::view_matrix(_trans.<a class="code" href="structmkr_1_1local__to__world.html#aa25ce595f7bf081bd02ee2e1faa2bd63">position_</a>, vector3::forwards(), vector3::down()),</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;            projection_matrix * matrix_util::view_matrix(_trans.<a class="code" href="structmkr_1_1local__to__world.html#aa25ce595f7bf081bd02ee2e1faa2bd63">position_</a>, vector3::backwards(), vector3::down()),</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;        };</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160; </div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;        <span class="keyword">auto</span> shader = <a class="code" href="classmkr_1_1material.html#a94f19dea49b24b9477a696b80217d6c0">mkr::material::shadow_shader_cube_</a>;</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;        shader-&gt;<a class="code" href="classmkr_1_1shader__program.html#a718cfdf922d5d469812bbff3a4738221">use</a>();</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160; </div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;        shader-&gt;set_uniform(shadow_cubemap_shader::uniform::u_view_projection_matrices0, <span class="keyword">false</span>, view_projection_matrices[0]);</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;        shader-&gt;set_uniform(shadow_cubemap_shader::uniform::u_view_projection_matrices1, <span class="keyword">false</span>, view_projection_matrices[1]);</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;        shader-&gt;set_uniform(shadow_cubemap_shader::uniform::u_view_projection_matrices2, <span class="keyword">false</span>, view_projection_matrices[2]);</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;        shader-&gt;set_uniform(shadow_cubemap_shader::uniform::u_view_projection_matrices3, <span class="keyword">false</span>, view_projection_matrices[3]);</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;        shader-&gt;set_uniform(shadow_cubemap_shader::uniform::u_view_projection_matrices4, <span class="keyword">false</span>, view_projection_matrices[4]);</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;        shader-&gt;set_uniform(shadow_cubemap_shader::uniform::u_view_projection_matrices5, <span class="keyword">false</span>, view_projection_matrices[5]);</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160; </div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;        shader-&gt;set_uniform(shadow_cubemap_shader::uniform::u_light_pos, _trans.<a class="code" href="structmkr_1_1local__to__world.html#aa25ce595f7bf081bd02ee2e1faa2bd63">position_</a>);</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;        shader-&gt;set_uniform(shadow_cubemap_shader::uniform::u_shadow_distance, _light.<a class="code" href="classmkr_1_1light.html#a7d83df0332d070c5026e4356d201909e">get_shadow_distance</a>());</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160; </div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;        <span class="keyword">const</span> <span class="keyword">auto</span> draw_func = [&amp;](std::unordered_map&lt;material*, std::unordered_map&lt;mesh*, std::vector&lt;matrix4x4&gt;&gt;&gt;&amp; _meshes, <span class="keywordtype">bool</span> _is_transparent) -&gt; <span class="keywordtype">void</span> {</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;            <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; material_iter : _meshes) {</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;                <span class="keyword">auto</span> material_ptr = material_iter.first;</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160; </div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;                <span class="keywordflow">if</span> (material_ptr-&gt;texture_diffuse_) { material_ptr-&gt;texture_diffuse_-&gt;bind(<a class="code" href="namespacemkr.html#a3f278ec75926bdfd4b49d1fd23c704dfa279c221a440a6e199736a992a2e13873">texture_unit::texture_diffuse</a>); }</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160; </div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;                shader-&gt;set_uniform(shadow_cubemap_shader::uniform::u_is_transparent, _is_transparent);</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;                shader-&gt;set_uniform(shadow_cubemap_shader::uniform::u_texture_offset, material_ptr-&gt;texture_offset_);</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;                shader-&gt;set_uniform(shadow_cubemap_shader::uniform::u_texture_scale, material_ptr-&gt;texture_scale_);</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;                shader-&gt;set_uniform(shadow_cubemap_shader::uniform::u_diffuse_colour, material_ptr-&gt;diffuse_colour_);</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;                shader-&gt;set_uniform(shadow_cubemap_shader::uniform::u_has_texture_diffuse, material_ptr-&gt;texture_diffuse_ != <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160; </div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;                <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; mesh_iter : material_iter.second) {</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;                    <span class="keyword">auto</span> mesh_ptr = mesh_iter.first;</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;                    <span class="keyword">auto</span>&amp; model_matrices = mesh_iter.second;</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160; </div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;                    std::vector&lt;mesh_instance_data&gt; batch;</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;                    <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; model_matrix : model_matrices) {</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;                        batch.push_back({model_matrix, matrix3x3::identity()});</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;                    }</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160; </div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;                    mesh_ptr-&gt;bind();</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;                    mesh_ptr-&gt;set_instance_data(batch);</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;                    glDrawElementsInstanced(GL_TRIANGLES, mesh_ptr-&gt;num_indices(), GL_UNSIGNED_INT, 0, model_matrices.size());</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;                }</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;            }</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;        };</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160; </div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;        draw_func(<a class="code" href="classmkr_1_1graphics__renderer.html#a43a2edd7a4f1420853e119ca87e3c084">deferred_meshes_</a>, <span class="keyword">false</span>);</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;        draw_func(<a class="code" href="classmkr_1_1graphics__renderer.html#a59742a9742830bf3076ea959fc754ef2">forward_meshes_</a>, <span class="keyword">false</span>);</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;        draw_func(<a class="code" href="classmkr_1_1graphics__renderer.html#aacb1c077166c9db226cbee3b901eee1d">transparent_meshes_</a>, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160; </div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;        <span class="keywordflow">return</span> matrix4x4::identity();</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    }</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160; </div>
<div class="line"><a name="l00234"></a><span class="lineno"><a class="line" href="classmkr_1_1graphics__renderer.html#ad5faef12b92a2717febc17b9cfe700b7">  234</a></span>&#160;    matrix4x4 <a class="code" href="classmkr_1_1graphics__renderer.html#ad5faef12b92a2717febc17b9cfe700b7">graphics_renderer::spot_shadow</a>(<a class="code" href="classmkr_1_1shadow__2d__buffer.html">shadow_2d_buffer</a>* _buffer, <span class="keyword">const</span> <a class="code" href="structmkr_1_1local__to__world.html">local_to_world</a>&amp; _trans, <span class="keyword">const</span> <a class="code" href="classmkr_1_1light.html">light</a>&amp; _light) {</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;        glDisable(GL_BLEND);</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;        glEnable(GL_DEPTH_TEST);</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;        glDepthMask(GL_TRUE);</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;        glDepthFunc(GL_LESS);</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;        glViewport(0, 0, _buffer-&gt;<a class="code" href="classmkr_1_1framebuffer.html#a655ac6cb85a26d0ee4f842b098268b57">width</a>(), _buffer-&gt;<a class="code" href="classmkr_1_1framebuffer.html#a5e6c6bffac007288e732c099526e66ff">height</a>()); <span class="comment">// Viewport size MUST be buffer size, else it won&#39;t render to the buffer correctly.</span></div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160; </div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;        _buffer-&gt;<a class="code" href="classmkr_1_1framebuffer.html#aa0c848e4bbe22fbd7c9772fa86c9e244">bind</a>();</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;        _buffer-&gt;<a class="code" href="classmkr_1_1framebuffer.html#ae4ed1d1cf196d0f5da5723b8b8b8c0ca">clear_depth_stencil</a>();</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160; </div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;        <span class="keyword">const</span> <span class="keyword">auto</span> view_matrix = matrix_util::view_matrix(_trans.<a class="code" href="structmkr_1_1local__to__world.html#aa25ce595f7bf081bd02ee2e1faa2bd63">position_</a>, _trans.<a class="code" href="structmkr_1_1local__to__world.html#acb399db3c95d0e625676a3bda7889e76">forward_</a>, _trans.<a class="code" href="structmkr_1_1local__to__world.html#a4c7f168c7e467eb74df9b23a421abfd3">up_</a>);</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;        <span class="keyword">const</span> <span class="keyword">auto</span> projection_matrix = matrix_util::perspective_matrix(1.0f, _light.<a class="code" href="classmkr_1_1light.html#ac6203bb21d92dffdb70f1102e4958571">get_spotlight_outer_angle</a>(), 0.1f, _light.<a class="code" href="classmkr_1_1light.html#a7d83df0332d070c5026e4356d201909e">get_shadow_distance</a>());</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160; </div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;        <span class="keyword">auto</span> shader = <a class="code" href="classmkr_1_1material.html#a3c8c14e67e7c89f6cf7ae53b529ab632">mkr::material::shadow_shader_2d_</a>;</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;        shader-&gt;<a class="code" href="classmkr_1_1shader__program.html#a718cfdf922d5d469812bbff3a4738221">use</a>();</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;        shader-&gt;set_uniform(shadow_2d_shader::uniform::u_view_matrix, <span class="keyword">false</span>, view_matrix);</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;        shader-&gt;set_uniform(shadow_2d_shader::uniform::u_projection_matrix, <span class="keyword">false</span>, projection_matrix);</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160; </div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;        <span class="keyword">const</span> <span class="keyword">auto</span> draw_func = [&amp;](std::unordered_map&lt;material*, std::unordered_map&lt;mesh*, std::vector&lt;matrix4x4&gt;&gt;&gt;&amp; _meshes, <span class="keywordtype">bool</span> _is_transparent) -&gt; <span class="keywordtype">void</span> {</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;            <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; material_iter : _meshes) {</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;                <span class="keyword">auto</span> material_ptr = material_iter.first;</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160; </div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;                <span class="keywordflow">if</span> (material_ptr-&gt;texture_diffuse_) { material_ptr-&gt;texture_diffuse_-&gt;bind(<a class="code" href="namespacemkr.html#a3f278ec75926bdfd4b49d1fd23c704dfa279c221a440a6e199736a992a2e13873">texture_unit::texture_diffuse</a>); }</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160; </div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;                shader-&gt;set_uniform(shadow_2d_shader::uniform::u_is_transparent, _is_transparent);</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;                shader-&gt;set_uniform(shadow_2d_shader::uniform::u_texture_offset, material_ptr-&gt;texture_offset_);</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;                shader-&gt;set_uniform(shadow_2d_shader::uniform::u_texture_scale, material_ptr-&gt;texture_scale_);</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;                shader-&gt;set_uniform(shadow_2d_shader::uniform::u_diffuse_colour, material_ptr-&gt;diffuse_colour_);</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;                shader-&gt;set_uniform(shadow_2d_shader::uniform::u_has_texture_diffuse, material_ptr-&gt;texture_diffuse_ != <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160; </div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;                <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; mesh_iter : material_iter.second) {</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;                    <span class="keyword">auto</span> mesh_ptr = mesh_iter.first;</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;                    <span class="keyword">auto</span>&amp; model_matrices = mesh_iter.second;</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160; </div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;                    std::vector&lt;mesh_instance_data&gt; batch;</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;                    <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; model_matrix : model_matrices) {</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;                        batch.push_back({model_matrix, matrix3x3::identity()});</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;                    }</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160; </div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;                    mesh_ptr-&gt;bind();</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;                    mesh_ptr-&gt;set_instance_data(batch);</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;                    glDrawElementsInstanced(GL_TRIANGLES, mesh_ptr-&gt;num_indices(), GL_UNSIGNED_INT, 0, model_matrices.size());</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;                }</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;            }</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;        };</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160; </div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;        draw_func(<a class="code" href="classmkr_1_1graphics__renderer.html#a43a2edd7a4f1420853e119ca87e3c084">deferred_meshes_</a>, <span class="keyword">false</span>);</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;        draw_func(<a class="code" href="classmkr_1_1graphics__renderer.html#a59742a9742830bf3076ea959fc754ef2">forward_meshes_</a>, <span class="keyword">false</span>);</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;        draw_func(<a class="code" href="classmkr_1_1graphics__renderer.html#aacb1c077166c9db226cbee3b901eee1d">transparent_meshes_</a>, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160; </div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;        <span class="keywordflow">return</span> projection_matrix * view_matrix;</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    }</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160; </div>
<div class="line"><a name="l00287"></a><span class="lineno"><a class="line" href="classmkr_1_1graphics__renderer.html#a03b093c17c37fada37b9ddda4fdfd027">  287</a></span>&#160;    matrix4x4 <a class="code" href="classmkr_1_1graphics__renderer.html#a03b093c17c37fada37b9ddda4fdfd027">graphics_renderer::directional_shadow</a>(<a class="code" href="classmkr_1_1shadow__2d__buffer.html">shadow_2d_buffer</a>* _buffer, <span class="keyword">const</span> <a class="code" href="structmkr_1_1local__to__world.html">local_to_world</a>&amp; _light_trans, <span class="keyword">const</span> <a class="code" href="classmkr_1_1light.html">light</a>&amp; _light, <span class="keyword">const</span> <a class="code" href="structmkr_1_1local__to__world.html">local_to_world</a>&amp; _cam_trans, <span class="keyword">const</span> <a class="code" href="structmkr_1_1camera.html">camera</a>&amp; _cam) {</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;        glDisable(GL_BLEND);</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;        glEnable(GL_DEPTH_TEST);</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;        glDepthMask(GL_TRUE);</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;        glDepthFunc(GL_LESS);</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;        glViewport(0, 0, _buffer-&gt;<a class="code" href="classmkr_1_1framebuffer.html#a655ac6cb85a26d0ee4f842b098268b57">width</a>(), _buffer-&gt;<a class="code" href="classmkr_1_1framebuffer.html#a5e6c6bffac007288e732c099526e66ff">height</a>()); <span class="comment">// Viewport size MUST be buffer size, else it won&#39;t render to the buffer correctly.</span></div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160; </div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;        _buffer-&gt;<a class="code" href="classmkr_1_1framebuffer.html#aa0c848e4bbe22fbd7c9772fa86c9e244">bind</a>();</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;        _buffer-&gt;<a class="code" href="classmkr_1_1framebuffer.html#ae4ed1d1cf196d0f5da5723b8b8b8c0ca">clear_depth_stencil</a>();</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160; </div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;        <span class="keyword">const</span> <span class="keyword">auto</span> light_view_matrix = matrix_util::view_matrix(vector3::zero(), _light_trans.<a class="code" href="structmkr_1_1local__to__world.html#acb399db3c95d0e625676a3bda7889e76">forward_</a>, _light_trans.<a class="code" href="structmkr_1_1local__to__world.html#a4c7f168c7e467eb74df9b23a421abfd3">up_</a>);</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;        <span class="keyword">const</span> <span class="keyword">auto</span> light_view_matrix_inverse = light_view_matrix.transposed(); <span class="comment">// Since translation is 0, inverse equals transpose.</span></div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;        <span class="keyword">const</span> <span class="keyword">auto</span> bounds = <a class="code" href="classmkr_1_1shadow__bounds.html#acffd143c67c948584fe6e6d18b3d1e0a">shadow_bounds::get_perspective_bounds</a>(light_view_matrix,</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;                                                                  _cam_trans.<a class="code" href="structmkr_1_1local__to__world.html#aa25ce595f7bf081bd02ee2e1faa2bd63">position_</a>,</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;                                                                  _cam_trans.<a class="code" href="structmkr_1_1local__to__world.html#a56b092fda8cee1c4341665d05bc3c48b">left_</a>, _cam_trans.<a class="code" href="structmkr_1_1local__to__world.html#a4c7f168c7e467eb74df9b23a421abfd3">up_</a>, _cam_trans.<a class="code" href="structmkr_1_1local__to__world.html#acb399db3c95d0e625676a3bda7889e76">forward_</a>,</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;                                                                  _cam.<a class="code" href="structmkr_1_1camera.html#a85c8e9d8829c7a247624ec3f77bab5cf">near_plane_</a>, _light.<a class="code" href="classmkr_1_1light.html#a7d83df0332d070c5026e4356d201909e">get_shadow_distance</a>(),</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;                                                                  _cam.<a class="code" href="structmkr_1_1camera.html#a290154c0ca1cc7d964bebcf2db164f91">aspect_ratio_</a>, _cam.<a class="code" href="structmkr_1_1camera.html#ae45bc29cd21e447b21c4f247d11a1ff9">fov_</a>);</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">float</span> width = bounds.max().x_ - bounds.min().x_;</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">float</span> height = bounds.max().y_ - bounds.min().y_;</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">float</span> near = bounds.min().z_ - bounds.centre().z_;</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">float</span> far = bounds.max().z_ - bounds.centre().z_;</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;        <span class="keyword">const</span> <span class="keyword">auto</span> view_matrix = matrix_util::view_matrix(light_view_matrix_inverse * bounds.centre(), _light_trans.<a class="code" href="structmkr_1_1local__to__world.html#acb399db3c95d0e625676a3bda7889e76">forward_</a>, _light_trans.<a class="code" href="structmkr_1_1local__to__world.html#a4c7f168c7e467eb74df9b23a421abfd3">up_</a>);</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;        <span class="keyword">const</span> <span class="keyword">auto</span> projection_matrix = matrix_util::orthographic_matrix(width / height, height, near, far);</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160; </div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;        <span class="keyword">auto</span> shader = <a class="code" href="classmkr_1_1material.html#a3c8c14e67e7c89f6cf7ae53b529ab632">mkr::material::shadow_shader_2d_</a>;</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;        shader-&gt;<a class="code" href="classmkr_1_1shader__program.html#a718cfdf922d5d469812bbff3a4738221">use</a>();</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;        shader-&gt;set_uniform(shadow_2d_shader::uniform::u_view_matrix, <span class="keyword">false</span>, view_matrix);</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;        shader-&gt;set_uniform(shadow_2d_shader::uniform::u_projection_matrix, <span class="keyword">false</span>, projection_matrix);</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160; </div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;        <span class="keyword">const</span> <span class="keyword">auto</span> draw_func = [&amp;](std::unordered_map&lt;material*, std::unordered_map&lt;mesh*, std::vector&lt;matrix4x4&gt;&gt;&gt;&amp; _meshes, <span class="keywordtype">bool</span> _is_transparent) -&gt; <span class="keywordtype">void</span> {</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;            <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; material_iter : _meshes) {</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;                <span class="keyword">auto</span> material_ptr = material_iter.first;</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160; </div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;                <span class="keywordflow">if</span> (material_ptr-&gt;texture_diffuse_) { material_ptr-&gt;texture_diffuse_-&gt;bind(<a class="code" href="namespacemkr.html#a3f278ec75926bdfd4b49d1fd23c704dfa279c221a440a6e199736a992a2e13873">texture_unit::texture_diffuse</a>); }</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160; </div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;                shader-&gt;set_uniform(shadow_2d_shader::uniform::u_is_transparent, _is_transparent);</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;                shader-&gt;set_uniform(shadow_2d_shader::uniform::u_texture_offset, material_ptr-&gt;texture_offset_);</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;                shader-&gt;set_uniform(shadow_2d_shader::uniform::u_texture_scale, material_ptr-&gt;texture_scale_);</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;                shader-&gt;set_uniform(shadow_2d_shader::uniform::u_diffuse_colour, material_ptr-&gt;diffuse_colour_);</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;                shader-&gt;set_uniform(shadow_2d_shader::uniform::u_has_texture_diffuse, material_ptr-&gt;texture_diffuse_ != <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160; </div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;                <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; mesh_iter : material_iter.second) {</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;                    <span class="keyword">auto</span> mesh_ptr = mesh_iter.first;</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;                    <span class="keyword">auto</span>&amp; model_matrices = mesh_iter.second;</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160; </div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;                    std::vector&lt;mesh_instance_data&gt; batch;</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;                    <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; model_matrix : model_matrices) {</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;                        batch.push_back({model_matrix, matrix3x3::identity()});</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;                    }</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160; </div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;                    mesh_ptr-&gt;bind();</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;                    mesh_ptr-&gt;set_instance_data(batch);</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;                    glDrawElementsInstanced(GL_TRIANGLES, mesh_ptr-&gt;num_indices(), GL_UNSIGNED_INT, 0, model_matrices.size());</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;                }</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;            }</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;        };</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160; </div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;        draw_func(<a class="code" href="classmkr_1_1graphics__renderer.html#a43a2edd7a4f1420853e119ca87e3c084">deferred_meshes_</a>, <span class="keyword">false</span>);</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;        draw_func(<a class="code" href="classmkr_1_1graphics__renderer.html#a59742a9742830bf3076ea959fc754ef2">forward_meshes_</a>, <span class="keyword">false</span>);</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;        draw_func(<a class="code" href="classmkr_1_1graphics__renderer.html#aacb1c077166c9db226cbee3b901eee1d">transparent_meshes_</a>, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160; </div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;        <span class="keywordflow">return</span> projection_matrix * view_matrix;</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    }</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160; </div>
<div class="line"><a name="l00351"></a><span class="lineno"><a class="line" href="classmkr_1_1graphics__renderer.html#aab27889f37c8c7661c5ade22f1b88e0b">  351</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classmkr_1_1graphics__renderer.html#aab27889f37c8c7661c5ade22f1b88e0b">graphics_renderer::geometry_pass</a>(<span class="keyword">const</span> matrix4x4&amp; _view_matrix, <span class="keyword">const</span> matrix4x4&amp; _projection_matrix) {</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;        glDisable(GL_BLEND);</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;        glEnable(GL_DEPTH_TEST);</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;        glDepthMask(GL_TRUE);</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;        glDepthFunc(GL_LESS);</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;        glViewport(0, 0, <a class="code" href="classmkr_1_1graphics__renderer.html#afa7c11f1aedc94b816a01e5ed5affeb2">g_buff_</a>-&gt;width(), <a class="code" href="classmkr_1_1graphics__renderer.html#afa7c11f1aedc94b816a01e5ed5affeb2">g_buff_</a>-&gt;height()); <span class="comment">// Viewport size MUST be buffer size, else it won&#39;t render to the buffer correctly.</span></div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160; </div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;        <a class="code" href="classmkr_1_1graphics__renderer.html#afa7c11f1aedc94b816a01e5ed5affeb2">g_buff_</a>-&gt;bind();</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;        <a class="code" href="classmkr_1_1graphics__renderer.html#afa7c11f1aedc94b816a01e5ed5affeb2">g_buff_</a>-&gt;set_draw_colour_attachment_all();</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;        <a class="code" href="classmkr_1_1graphics__renderer.html#afa7c11f1aedc94b816a01e5ed5affeb2">g_buff_</a>-&gt;clear_colour_all();</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;        <a class="code" href="classmkr_1_1graphics__renderer.html#afa7c11f1aedc94b816a01e5ed5affeb2">g_buff_</a>-&gt;clear_depth_stencil();</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160; </div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;        <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; material_iter : <a class="code" href="classmkr_1_1graphics__renderer.html#a43a2edd7a4f1420853e119ca87e3c084">deferred_meshes_</a>) {</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;            <span class="keyword">auto</span> material_ptr = material_iter.first;</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;            <span class="keyword">auto</span> shader = <a class="code" href="classmkr_1_1material.html#ad2f7bdd6e381175da6aca200fb726c14">material::geometry_shader_</a>;</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;            shader-&gt;<a class="code" href="classmkr_1_1shader__program.html#a718cfdf922d5d469812bbff3a4738221">use</a>();</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160; </div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;            <span class="comment">// Bind textures.</span></div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;            <span class="keywordflow">if</span> (material_ptr-&gt;texture_diffuse_) { material_ptr-&gt;texture_diffuse_-&gt;bind(<a class="code" href="namespacemkr.html#a3f278ec75926bdfd4b49d1fd23c704dfa279c221a440a6e199736a992a2e13873">texture_unit::texture_diffuse</a>); }</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;            <span class="keywordflow">if</span> (material_ptr-&gt;texture_normal_) { material_ptr-&gt;texture_normal_-&gt;bind(<a class="code" href="namespacemkr.html#a3f278ec75926bdfd4b49d1fd23c704dfa2e6f41bb29037dc80504b943a03a37f5">texture_unit::texture_normal</a>); }</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;            <span class="keywordflow">if</span> (material_ptr-&gt;texture_specular_) { material_ptr-&gt;texture_specular_-&gt;bind(<a class="code" href="namespacemkr.html#a3f278ec75926bdfd4b49d1fd23c704dfa77f77f76d87adf102db0c97761a32f89">texture_unit::texture_specular</a>); }</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;            <span class="keywordflow">if</span> (material_ptr-&gt;texture_displacement_) { material_ptr-&gt;texture_displacement_-&gt;bind(<a class="code" href="namespacemkr.html#a3f278ec75926bdfd4b49d1fd23c704dfa713a31f5dc6be65e75247060dc49742e">texture_unit::texture_displacement</a>); }</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160; </div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;            <span class="comment">// Transform</span></div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;            shader-&gt;set_uniform(geometry_shader::uniform::u_view_matrix, <span class="keyword">false</span>, _view_matrix);</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;            shader-&gt;set_uniform(geometry_shader::uniform::u_projection_matrix, <span class="keyword">false</span>, _projection_matrix);</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;            shader-&gt;set_uniform(geometry_shader::uniform::u_texture_offset, material_ptr-&gt;texture_offset_);</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;            shader-&gt;set_uniform(geometry_shader::uniform::u_texture_scale, material_ptr-&gt;texture_scale_);</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160; </div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;            <span class="comment">// Material</span></div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;            shader-&gt;set_uniform(geometry_shader::uniform::u_diffuse_colour, material_ptr-&gt;diffuse_colour_);</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;            shader-&gt;set_uniform(geometry_shader::uniform::u_specular_colour, material_ptr-&gt;specular_colour_);</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;            shader-&gt;set_uniform(geometry_shader::uniform::u_displacement_scale, material_ptr-&gt;displacement_scale_);</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160; </div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;            <span class="comment">// Textures</span></div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;            shader-&gt;set_uniform(geometry_shader::uniform::u_has_texture_diffuse, material_ptr-&gt;texture_diffuse_ != <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;            shader-&gt;set_uniform(geometry_shader::uniform::u_has_texture_normal, material_ptr-&gt;texture_normal_ != <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;            shader-&gt;set_uniform(geometry_shader::uniform::u_has_texture_specular, material_ptr-&gt;texture_specular_ != <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;            shader-&gt;set_uniform(geometry_shader::uniform::u_has_texture_displacement, material_ptr-&gt;texture_displacement_ != <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160; </div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;            <span class="comment">// Draw to screen.</span></div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;            <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; mesh_iter : material_iter.second) {</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;                <span class="keyword">auto</span> mesh_ptr = mesh_iter.first;</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;                <span class="keyword">auto</span>&amp; model_matrices = mesh_iter.second;</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160; </div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;                std::vector&lt;mesh_instance_data&gt; batch;</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;                <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; model_matrix : model_matrices) {</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;                    <span class="keyword">const</span> <span class="keyword">auto</span> model_view_inverse = matrix_util::inverse_matrix(_view_matrix * model_matrix).value_or(matrix4x4::identity());</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;                    <span class="keyword">const</span> <span class="keyword">auto</span> normal_matrix = matrix_util::minor_matrix(model_view_inverse.transposed(), 3, 3);</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;                    batch.push_back({model_matrix, normal_matrix});</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;                }</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160; </div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;                mesh_ptr-&gt;bind();</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;                mesh_ptr-&gt;set_instance_data(batch);</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;                glDrawElementsInstanced(GL_TRIANGLES, mesh_ptr-&gt;num_indices(), GL_UNSIGNED_INT, 0, model_matrices.size());</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;            }</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;        }</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    }</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160; </div>
<div class="line"><a name="l00410"></a><span class="lineno"><a class="line" href="classmkr_1_1graphics__renderer.html#a57ff6c77dfaea39eeb2716d18fa8a18c">  410</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classmkr_1_1graphics__renderer.html#a57ff6c77dfaea39eeb2716d18fa8a18c">graphics_renderer::lighting_pass</a>(<span class="keyword">const</span> matrix4x4&amp; _view_matrix, <span class="keyword">const</span> matrix4x4&amp; _inv_view_matrix, <span class="keyword">const</span> vector3&amp; _view_dir_x, <span class="keyword">const</span> vector3&amp; _view_dir_y, <span class="keyword">const</span> vector3&amp; _view_dir_z) {</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;        glDisable(GL_BLEND);</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;        glDisable(GL_DEPTH_TEST);</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;        glViewport(0, 0, <a class="code" href="classmkr_1_1graphics__renderer.html#aa2de2e0108508425cf4a68f549e1d377">l_buff_</a>-&gt;width(), <a class="code" href="classmkr_1_1graphics__renderer.html#aa2de2e0108508425cf4a68f549e1d377">l_buff_</a>-&gt;height());</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160; </div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;        <a class="code" href="classmkr_1_1graphics__renderer.html#aa2de2e0108508425cf4a68f549e1d377">l_buff_</a>-&gt;bind();</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;        <a class="code" href="classmkr_1_1graphics__renderer.html#aa2de2e0108508425cf4a68f549e1d377">l_buff_</a>-&gt;set_draw_colour_attachment_all();</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;        <a class="code" href="classmkr_1_1graphics__renderer.html#aa2de2e0108508425cf4a68f549e1d377">l_buff_</a>-&gt;clear_colour_all();</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160; </div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;        <span class="comment">// Use shader.</span></div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;        <span class="keyword">auto</span> shader = <a class="code" href="classmkr_1_1material.html#a61d1dd0c97915c693a1c1a284b748060">material::light_shader_</a>;</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;        shader-&gt;<a class="code" href="classmkr_1_1shader__program.html#a718cfdf922d5d469812bbff3a4738221">use</a>();</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160; </div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;        <span class="comment">// Bind mesh.</span></div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;        <a class="code" href="classmkr_1_1graphics__renderer.html#a5a1d94db42b966794e8177cdf2515c48">screen_quad_</a>-&gt;bind();</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;        <a class="code" href="classmkr_1_1graphics__renderer.html#a5a1d94db42b966794e8177cdf2515c48">screen_quad_</a>-&gt;set_instance_data({{matrix4x4::identity(), matrix3x3::identity()}});</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160; </div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;        <span class="comment">// Bind textures.</span></div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;        <a class="code" href="classmkr_1_1graphics__renderer.html#afa7c11f1aedc94b816a01e5ed5affeb2">g_buff_</a>-&gt;get_colour_attachment(<a class="code" href="namespacemkr.html#abe8c29bfe2e55bc16a894b1120995935a8fe021f67e720dc9c296da06e976b14f">geometry_buffer::colour_attachments::position</a>)-&gt;bind(<a class="code" href="namespacemkr.html#a3f278ec75926bdfd4b49d1fd23c704dfa4779b46fb5d4803d6806d6d5b5faccc0">texture_unit::texture_position</a>);</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;        <a class="code" href="classmkr_1_1graphics__renderer.html#afa7c11f1aedc94b816a01e5ed5affeb2">g_buff_</a>-&gt;get_colour_attachment(<a class="code" href="namespacemkr.html#abe8c29bfe2e55bc16a894b1120995935a09c06e9a8d2038500e21bae962a5abc7">geometry_buffer::colour_attachments::normal</a>)-&gt;bind(<a class="code" href="namespacemkr.html#a3f278ec75926bdfd4b49d1fd23c704dfa2e6f41bb29037dc80504b943a03a37f5">texture_unit::texture_normal</a>);</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;        <a class="code" href="classmkr_1_1graphics__renderer.html#afa7c11f1aedc94b816a01e5ed5affeb2">g_buff_</a>-&gt;get_colour_attachment(geometry_buffer::colour_attachments::diffuse)-&gt;bind(<a class="code" href="namespacemkr.html#a3f278ec75926bdfd4b49d1fd23c704dfa279c221a440a6e199736a992a2e13873">texture_unit::texture_diffuse</a>);</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;        <a class="code" href="classmkr_1_1graphics__renderer.html#afa7c11f1aedc94b816a01e5ed5affeb2">g_buff_</a>-&gt;get_colour_attachment(geometry_buffer::colour_attachments::specular)-&gt;bind(<a class="code" href="namespacemkr.html#a3f278ec75926bdfd4b49d1fd23c704dfa77f77f76d87adf102db0c97761a32f89">texture_unit::texture_specular</a>);</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160; </div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;        <span class="comment">// Bind shadow maps.</span></div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;        <span class="keyword">const</span> <span class="keyword">auto</span> num_lights = maths_util::min&lt;int32_t&gt;(<a class="code" href="classmkr_1_1graphics__renderer.html#abb759c34beb9aaecf69842a174b64ad0">lights_</a>.size(), <a class="code" href="classmkr_1_1lighting.html#a1d2c15e1eaa3c8162a4a6773a9be5d4e">lighting::max_lights</a>);</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;        <span class="keywordflow">for</span> (<span class="keyword">auto</span> i = 0; i &lt; num_lights; ++i) {</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="namespacemkr.html#a898cbea13b10a6143c2faf35f4a0fbc2ac895ec5b78e7a9170494460bc36e10a8">light_mode::point</a> == <a class="code" href="classmkr_1_1graphics__renderer.html#abb759c34beb9aaecf69842a174b64ad0">lights_</a>[i].light_.get_mode()) {</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;                <a class="code" href="classmkr_1_1graphics__renderer.html#a3dbb1e5e1ad7620aaa5361aadb891637">scube_buff_</a>[i]-&gt;get_depth_stencil_attachment()-&gt;bind(<a class="code" href="namespacemkr.html#a3f278ec75926bdfd4b49d1fd23c704dfa56a127e30908390a1aa07e17d77be169">texture_unit::cubemap_shadows0</a> + i);</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;                <a class="code" href="classmkr_1_1graphics__renderer.html#a59ae33da60e332c8a6de4ea65ed8937e">s2d_buff_</a>[i]-&gt;get_depth_stencil_attachment()-&gt;bind(<a class="code" href="namespacemkr.html#a3f278ec75926bdfd4b49d1fd23c704dfad0d43d452801153231699bb9e84733ac">texture_unit::texture_shadows0</a> + i);</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;            }</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;        }</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160; </div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;        <span class="comment">// Transform</span></div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;        shader-&gt;set_uniform(lighting_shader::uniform::u_inv_view_matrix, <span class="keyword">false</span>, _inv_view_matrix);</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160; </div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;        <span class="comment">// Lights.</span></div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;        shader-&gt;set_uniform(lighting_shader::uniform::u_num_lights, num_lights);</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;        shader-&gt;set_uniform(lighting_shader::uniform::u_ambient_light, <a class="code" href="classmkr_1_1lighting.html#a05fdf0bf39258c6d1bde9dde1d3a145d">lighting::ambient_light_</a>);</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160; </div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;        <span class="keywordflow">for</span> (<span class="keyword">auto</span> i = 0; i &lt; num_lights; ++i) {</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;            <span class="keyword">const</span> <span class="keyword">auto</span>&amp; t = <a class="code" href="classmkr_1_1graphics__renderer.html#abb759c34beb9aaecf69842a174b64ad0">lights_</a>[i].transform_;</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;            <span class="keyword">const</span> <span class="keyword">auto</span>&amp; l = <a class="code" href="classmkr_1_1graphics__renderer.html#abb759c34beb9aaecf69842a174b64ad0">lights_</a>[i].light_;</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160; </div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;            <span class="keyword">const</span> <span class="keyword">auto</span> light_pos_view = _view_matrix * t.position_; <span class="comment">// Light position in view space.</span></div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;            <span class="keyword">const</span> <span class="keyword">auto</span> light_dir_view = vector3{_view_dir_x.dot(t.forward_), _view_dir_y.dot(t.forward_), _view_dir_z.dot(t.forward_)}.normalised(); <span class="comment">// Light direction in view space.</span></div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160; </div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;            shader-&gt;set_uniform(i + lighting_shader::uniform::u_light_mode0, l.get_mode());</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;            shader-&gt;set_uniform(i + lighting_shader::uniform::u_light_power0, l.get_power());</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;            shader-&gt;set_uniform(i + lighting_shader::uniform::u_light_colour0, l.get_colour());</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160; </div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;            shader-&gt;set_uniform(i + lighting_shader::uniform::u_light_attenuation_constant0, l.get_attenuation_constant());</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;            shader-&gt;set_uniform(i + lighting_shader::uniform::u_light_attenuation_linear0, l.get_attenuation_linear());</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;            shader-&gt;set_uniform(i + lighting_shader::uniform::u_light_attenuation_quadratic0, l.get_attenuation_quadratic());</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160; </div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;            shader-&gt;set_uniform(i + lighting_shader::uniform::u_light_spotlight_inner_cosine0, l.get_spotlight_inner_consine());</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;            shader-&gt;set_uniform(i + lighting_shader::uniform::u_light_spotlight_outer_cosine0, l.get_spotlight_outer_consine());</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160; </div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;            shader-&gt;set_uniform(i + lighting_shader::uniform::u_light_position0, light_pos_view);</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;            shader-&gt;set_uniform(i + lighting_shader::uniform::u_light_direction0, light_dir_view);</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160; </div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;            shader-&gt;set_uniform(i + lighting_shader::uniform::u_light_shadow_distance0, l.get_shadow_distance());</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;            shader-&gt;set_uniform(i + lighting_shader::uniform::u_light_view_projection_matrix0, <span class="keyword">false</span>, <a class="code" href="classmkr_1_1graphics__renderer.html#a3399e8c52b940298b171e96da149ba0d">light_view_projection_matrix_</a>[i]);</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;        }</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160; </div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;        <span class="comment">// Draw.</span></div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;        glDrawElementsInstanced(GL_TRIANGLES, <a class="code" href="classmkr_1_1graphics__renderer.html#a5a1d94db42b966794e8177cdf2515c48">screen_quad_</a>-&gt;num_indices(), GL_UNSIGNED_INT, 0, 1);</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;    }</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160; </div>
<div class="line"><a name="l00479"></a><span class="lineno"><a class="line" href="classmkr_1_1graphics__renderer.html#aeb05b71134e3b598496187bf4d659e78">  479</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classmkr_1_1graphics__renderer.html#aeb05b71134e3b598496187bf4d659e78">graphics_renderer::forward_pass</a>(<span class="keyword">const</span> matrix4x4&amp; _view_matrix, <span class="keyword">const</span> matrix4x4&amp; _projection_matrix, <span class="keyword">const</span> matrix4x4&amp; _inv_view_matrix, <span class="keyword">const</span> vector3&amp; _view_dir_x, <span class="keyword">const</span> vector3&amp; _view_dir_y, <span class="keyword">const</span> vector3&amp; _view_dir_z) {</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;        glDisable(GL_BLEND);</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;        glEnable(GL_DEPTH_TEST);</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;        glDepthMask(GL_TRUE);</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;        glDepthFunc(GL_LESS);</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160; </div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;        glViewport(0, 0, <a class="code" href="classmkr_1_1graphics__renderer.html#a901ae3acb341793861c91c306402b0d6">f_buff_</a>-&gt;width(), <a class="code" href="classmkr_1_1graphics__renderer.html#a901ae3acb341793861c91c306402b0d6">f_buff_</a>-&gt;height());</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160; </div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;        <span class="comment">// Clear colour attachments.</span></div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;        <a class="code" href="classmkr_1_1graphics__renderer.html#a901ae3acb341793861c91c306402b0d6">f_buff_</a>-&gt;bind();</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;        <a class="code" href="classmkr_1_1graphics__renderer.html#a901ae3acb341793861c91c306402b0d6">f_buff_</a>-&gt;set_draw_colour_attachment_all();</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;        <a class="code" href="classmkr_1_1graphics__renderer.html#a901ae3acb341793861c91c306402b0d6">f_buff_</a>-&gt;clear_colour_all();</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;        <a class="code" href="classmkr_1_1graphics__renderer.html#a901ae3acb341793861c91c306402b0d6">f_buff_</a>-&gt;clear_depth_stencil();</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160; </div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;        <span class="comment">// Blit colour.</span></div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;        <a class="code" href="classmkr_1_1graphics__renderer.html#aa2de2e0108508425cf4a68f549e1d377">l_buff_</a>-&gt;set_read_colour_attachment(lighting_buffer::colour_attachments::colour);</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;        <a class="code" href="classmkr_1_1graphics__renderer.html#a901ae3acb341793861c91c306402b0d6">f_buff_</a>-&gt;set_draw_colour_attachment(forward_buffer::colour_attachments::colour);</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;        <a class="code" href="classmkr_1_1graphics__renderer.html#aa2de2e0108508425cf4a68f549e1d377">l_buff_</a>-&gt;blit_to(<a class="code" href="classmkr_1_1graphics__renderer.html#a901ae3acb341793861c91c306402b0d6">f_buff_</a>.get(), <span class="keyword">true</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, 0, 0, <a class="code" href="classmkr_1_1graphics__renderer.html#aa2de2e0108508425cf4a68f549e1d377">l_buff_</a>-&gt;width(), <a class="code" href="classmkr_1_1graphics__renderer.html#aa2de2e0108508425cf4a68f549e1d377">l_buff_</a>-&gt;height(), 0, 0, <a class="code" href="classmkr_1_1graphics__renderer.html#a901ae3acb341793861c91c306402b0d6">f_buff_</a>-&gt;width(), <a class="code" href="classmkr_1_1graphics__renderer.html#a901ae3acb341793861c91c306402b0d6">f_buff_</a>-&gt;height());</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160; </div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;        <span class="comment">// Blit positions.</span></div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;        <a class="code" href="classmkr_1_1graphics__renderer.html#afa7c11f1aedc94b816a01e5ed5affeb2">g_buff_</a>-&gt;set_read_colour_attachment(<a class="code" href="namespacemkr.html#abe8c29bfe2e55bc16a894b1120995935a8fe021f67e720dc9c296da06e976b14f">geometry_buffer::colour_attachments::position</a>);</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;        <a class="code" href="classmkr_1_1graphics__renderer.html#a901ae3acb341793861c91c306402b0d6">f_buff_</a>-&gt;set_draw_colour_attachment(<a class="code" href="namespacemkr.html#abe8c29bfe2e55bc16a894b1120995935a8fe021f67e720dc9c296da06e976b14f">forward_buffer::colour_attachments::position</a>);</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;        <a class="code" href="classmkr_1_1graphics__renderer.html#afa7c11f1aedc94b816a01e5ed5affeb2">g_buff_</a>-&gt;blit_to(<a class="code" href="classmkr_1_1graphics__renderer.html#a901ae3acb341793861c91c306402b0d6">f_buff_</a>.get(), <span class="keyword">true</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, 0, 0, <a class="code" href="classmkr_1_1graphics__renderer.html#afa7c11f1aedc94b816a01e5ed5affeb2">g_buff_</a>-&gt;width(), <a class="code" href="classmkr_1_1graphics__renderer.html#afa7c11f1aedc94b816a01e5ed5affeb2">g_buff_</a>-&gt;height(), 0, 0, <a class="code" href="classmkr_1_1graphics__renderer.html#a901ae3acb341793861c91c306402b0d6">f_buff_</a>-&gt;width(), <a class="code" href="classmkr_1_1graphics__renderer.html#a901ae3acb341793861c91c306402b0d6">f_buff_</a>-&gt;height());</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160; </div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;        <span class="comment">// Blit normals.</span></div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;        <a class="code" href="classmkr_1_1graphics__renderer.html#afa7c11f1aedc94b816a01e5ed5affeb2">g_buff_</a>-&gt;set_read_colour_attachment(<a class="code" href="namespacemkr.html#abe8c29bfe2e55bc16a894b1120995935a09c06e9a8d2038500e21bae962a5abc7">geometry_buffer::colour_attachments::normal</a>);</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;        <a class="code" href="classmkr_1_1graphics__renderer.html#a901ae3acb341793861c91c306402b0d6">f_buff_</a>-&gt;set_draw_colour_attachment(<a class="code" href="namespacemkr.html#abe8c29bfe2e55bc16a894b1120995935a09c06e9a8d2038500e21bae962a5abc7">forward_buffer::colour_attachments::normal</a>);</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;        <a class="code" href="classmkr_1_1graphics__renderer.html#afa7c11f1aedc94b816a01e5ed5affeb2">g_buff_</a>-&gt;blit_to(<a class="code" href="classmkr_1_1graphics__renderer.html#a901ae3acb341793861c91c306402b0d6">f_buff_</a>.get(), <span class="keyword">true</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, 0, 0, <a class="code" href="classmkr_1_1graphics__renderer.html#afa7c11f1aedc94b816a01e5ed5affeb2">g_buff_</a>-&gt;width(), <a class="code" href="classmkr_1_1graphics__renderer.html#afa7c11f1aedc94b816a01e5ed5affeb2">g_buff_</a>-&gt;height(), 0, 0, <a class="code" href="classmkr_1_1graphics__renderer.html#a901ae3acb341793861c91c306402b0d6">f_buff_</a>-&gt;width(), <a class="code" href="classmkr_1_1graphics__renderer.html#a901ae3acb341793861c91c306402b0d6">f_buff_</a>-&gt;height());</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160; </div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;        <span class="comment">// Blit depth-stencil.</span></div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;        <a class="code" href="classmkr_1_1graphics__renderer.html#afa7c11f1aedc94b816a01e5ed5affeb2">g_buff_</a>-&gt;blit_to(<a class="code" href="classmkr_1_1graphics__renderer.html#a901ae3acb341793861c91c306402b0d6">f_buff_</a>.get(), <span class="keyword">false</span>, <span class="keyword">true</span>, <span class="keyword">true</span>, 0, 0, <a class="code" href="classmkr_1_1graphics__renderer.html#afa7c11f1aedc94b816a01e5ed5affeb2">g_buff_</a>-&gt;width(), <a class="code" href="classmkr_1_1graphics__renderer.html#afa7c11f1aedc94b816a01e5ed5affeb2">g_buff_</a>-&gt;height(), 0, 0, <a class="code" href="classmkr_1_1graphics__renderer.html#a901ae3acb341793861c91c306402b0d6">f_buff_</a>-&gt;width(), <a class="code" href="classmkr_1_1graphics__renderer.html#a901ae3acb341793861c91c306402b0d6">f_buff_</a>-&gt;height());</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160; </div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;        <span class="comment">// Set draw attachments.</span></div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;        <a class="code" href="classmkr_1_1graphics__renderer.html#a901ae3acb341793861c91c306402b0d6">f_buff_</a>-&gt;set_draw_colour_attachment_all();</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160; </div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;        <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; material_iter : <a class="code" href="classmkr_1_1graphics__renderer.html#a59742a9742830bf3076ea959fc754ef2">forward_meshes_</a>) {</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;            <span class="keyword">auto</span> material_ptr = material_iter.first;</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;            <span class="keyword">auto</span> shader = material_ptr-&gt;forward_shader_;</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;            shader-&gt;use();</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160; </div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;            <span class="comment">// Bind textures.</span></div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;            <span class="keywordflow">if</span> (material_ptr-&gt;texture_diffuse_) { material_ptr-&gt;texture_diffuse_-&gt;bind(<a class="code" href="namespacemkr.html#a3f278ec75926bdfd4b49d1fd23c704dfa279c221a440a6e199736a992a2e13873">texture_unit::texture_diffuse</a>); }</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;            <span class="keywordflow">if</span> (material_ptr-&gt;texture_normal_) { material_ptr-&gt;texture_normal_-&gt;bind(<a class="code" href="namespacemkr.html#a3f278ec75926bdfd4b49d1fd23c704dfa2e6f41bb29037dc80504b943a03a37f5">texture_unit::texture_normal</a>); }</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;            <span class="keywordflow">if</span> (material_ptr-&gt;texture_specular_) { material_ptr-&gt;texture_specular_-&gt;bind(<a class="code" href="namespacemkr.html#a3f278ec75926bdfd4b49d1fd23c704dfa77f77f76d87adf102db0c97761a32f89">texture_unit::texture_specular</a>); }</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;            <span class="keywordflow">if</span> (material_ptr-&gt;texture_displacement_) { material_ptr-&gt;texture_displacement_-&gt;bind(<a class="code" href="namespacemkr.html#a3f278ec75926bdfd4b49d1fd23c704dfa713a31f5dc6be65e75247060dc49742e">texture_unit::texture_displacement</a>); }</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160; </div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;            <span class="comment">// Bind shadow maps.</span></div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;            <span class="keyword">const</span> <span class="keyword">auto</span> num_lights = maths_util::min&lt;int32_t&gt;(<a class="code" href="classmkr_1_1graphics__renderer.html#abb759c34beb9aaecf69842a174b64ad0">lights_</a>.size(), <a class="code" href="classmkr_1_1lighting.html#a1d2c15e1eaa3c8162a4a6773a9be5d4e">lighting::max_lights</a>);</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;            <span class="keywordflow">for</span> (<span class="keyword">auto</span> i = 0; i &lt; num_lights; ++i) {</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="namespacemkr.html#a898cbea13b10a6143c2faf35f4a0fbc2ac895ec5b78e7a9170494460bc36e10a8">light_mode::point</a> == <a class="code" href="classmkr_1_1graphics__renderer.html#abb759c34beb9aaecf69842a174b64ad0">lights_</a>[i].light_.get_mode()) {</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;                    <a class="code" href="classmkr_1_1graphics__renderer.html#a3dbb1e5e1ad7620aaa5361aadb891637">scube_buff_</a>[i]-&gt;get_depth_stencil_attachment()-&gt;bind(<a class="code" href="namespacemkr.html#a3f278ec75926bdfd4b49d1fd23c704dfa56a127e30908390a1aa07e17d77be169">texture_unit::cubemap_shadows0</a> + i);</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;                    <a class="code" href="classmkr_1_1graphics__renderer.html#a59ae33da60e332c8a6de4ea65ed8937e">s2d_buff_</a>[i]-&gt;get_depth_stencil_attachment()-&gt;bind(<a class="code" href="namespacemkr.html#a3f278ec75926bdfd4b49d1fd23c704dfad0d43d452801153231699bb9e84733ac">texture_unit::texture_shadows0</a> + i);</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;                }</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;            }</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160; </div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;            <span class="comment">// Transform</span></div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;            shader-&gt;set_uniform(forward_shader::uniform::u_view_matrix, <span class="keyword">false</span>, _view_matrix);</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;            shader-&gt;set_uniform(forward_shader::uniform::u_projection_matrix, <span class="keyword">false</span>, _projection_matrix);</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;            shader-&gt;set_uniform(forward_shader::uniform::u_texture_offset, material_ptr-&gt;texture_offset_);</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;            shader-&gt;set_uniform(forward_shader::uniform::u_texture_scale, material_ptr-&gt;texture_scale_);</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160; </div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;            shader-&gt;set_uniform(forward_shader::uniform::u_inv_view_matrix, <span class="keyword">false</span>, _inv_view_matrix);</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160; </div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;            <span class="comment">// Material</span></div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;            shader-&gt;set_uniform(forward_shader::uniform::u_diffuse_colour, material_ptr-&gt;diffuse_colour_);</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;            shader-&gt;set_uniform(forward_shader::uniform::u_specular_colour, material_ptr-&gt;specular_colour_);</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;            shader-&gt;set_uniform(forward_shader::uniform::u_displacement_scale, material_ptr-&gt;displacement_scale_);</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160; </div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;            <span class="comment">// Textures</span></div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;            shader-&gt;set_uniform(forward_shader::uniform::u_has_texture_diffuse, material_ptr-&gt;texture_diffuse_ != <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;            shader-&gt;set_uniform(forward_shader::uniform::u_has_texture_normal, material_ptr-&gt;texture_normal_ != <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;            shader-&gt;set_uniform(forward_shader::uniform::u_has_texture_specular, material_ptr-&gt;texture_specular_ != <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;            shader-&gt;set_uniform(forward_shader::uniform::u_has_texture_displacement, material_ptr-&gt;texture_displacement_ != <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160; </div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;            <span class="comment">// Lights</span></div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;            shader-&gt;set_uniform(forward_shader::uniform::u_num_lights, num_lights);</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;            shader-&gt;set_uniform(forward_shader::uniform::u_ambient_light, <a class="code" href="classmkr_1_1lighting.html#a05fdf0bf39258c6d1bde9dde1d3a145d">lighting::ambient_light_</a>);</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160; </div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;            <span class="keywordflow">for</span> (<span class="keyword">auto</span> i = 0; i &lt; num_lights; ++i) {</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;                <span class="keyword">const</span> <span class="keyword">auto</span>&amp; t = <a class="code" href="classmkr_1_1graphics__renderer.html#abb759c34beb9aaecf69842a174b64ad0">lights_</a>[i].transform_;</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;                <span class="keyword">const</span> <span class="keyword">auto</span>&amp; l = <a class="code" href="classmkr_1_1graphics__renderer.html#abb759c34beb9aaecf69842a174b64ad0">lights_</a>[i].light_;</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160; </div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;                <span class="keyword">const</span> <span class="keyword">auto</span> light_pos_view = _view_matrix * t.position_; <span class="comment">// Light position in view space.</span></div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;                <span class="keyword">const</span> <span class="keyword">auto</span> light_dir_view = vector3{_view_dir_x.dot(t.forward_), _view_dir_y.dot(t.forward_), _view_dir_z.dot(t.forward_)}.normalised(); <span class="comment">// Light direction in view space.</span></div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160; </div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;                shader-&gt;set_uniform(i + forward_shader::uniform::u_light_mode0, l.get_mode());</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;                shader-&gt;set_uniform(i + forward_shader::uniform::u_light_power0, l.get_power());</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;                shader-&gt;set_uniform(i + forward_shader::uniform::u_light_colour0, l.get_colour());</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160; </div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;                shader-&gt;set_uniform(i + forward_shader::uniform::u_light_attenuation_constant0, l.get_attenuation_constant());</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;                shader-&gt;set_uniform(i + forward_shader::uniform::u_light_attenuation_linear0, l.get_attenuation_linear());</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;                shader-&gt;set_uniform(i + forward_shader::uniform::u_light_attenuation_quadratic0, l.get_attenuation_quadratic());</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160; </div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;                shader-&gt;set_uniform(i + forward_shader::uniform::u_light_spotlight_inner_cosine0, l.get_spotlight_inner_consine());</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;                shader-&gt;set_uniform(i + forward_shader::uniform::u_light_spotlight_outer_cosine0, l.get_spotlight_outer_consine());</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160; </div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;                shader-&gt;set_uniform(i + forward_shader::uniform::u_light_position0, light_pos_view);</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;                shader-&gt;set_uniform(i + forward_shader::uniform::u_light_direction0, light_dir_view);</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160; </div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;                shader-&gt;set_uniform(i + forward_shader::uniform::u_light_shadow_distance0, l.get_shadow_distance());</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;                shader-&gt;set_uniform(i + forward_shader::uniform::u_light_view_projection_matrix0, <span class="keyword">false</span>, <a class="code" href="classmkr_1_1graphics__renderer.html#a3399e8c52b940298b171e96da149ba0d">light_view_projection_matrix_</a>[i]);</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;            }</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160; </div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;            <span class="comment">// Draw to screen.</span></div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;            <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; mesh_iter : material_iter.second) {</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;                <span class="keyword">auto</span> mesh_ptr = mesh_iter.first;</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;                <span class="keyword">auto</span>&amp; model_matrices = mesh_iter.second;</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160; </div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;                std::vector&lt;mesh_instance_data&gt; batch;</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;                <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; model_matrix : model_matrices) {</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;                    <span class="keyword">const</span> <span class="keyword">auto</span> model_view_inverse = matrix_util::inverse_matrix(_view_matrix * model_matrix).value_or(matrix4x4::identity());</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;                    <span class="keyword">const</span> <span class="keyword">auto</span> normal_matrix = matrix_util::minor_matrix(model_view_inverse.transposed(), 3, 3);</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;                    batch.push_back({model_matrix, normal_matrix});</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;                }</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160; </div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;                mesh_ptr-&gt;bind();</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;                mesh_ptr-&gt;set_instance_data(batch);</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;                glDrawElementsInstanced(GL_TRIANGLES, mesh_ptr-&gt;num_indices(), GL_UNSIGNED_INT, 0, model_matrices.size());</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;            }</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;        }</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;    }</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160; </div>
<div class="line"><a name="l00602"></a><span class="lineno"><a class="line" href="classmkr_1_1graphics__renderer.html#a4cfea9b043d9434c6ff483f7b99d2d9c">  602</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classmkr_1_1graphics__renderer.html#a4cfea9b043d9434c6ff483f7b99d2d9c">graphics_renderer::alpha_weight_pass</a>(<span class="keyword">const</span> matrix4x4&amp; _view_matrix, <span class="keyword">const</span> matrix4x4&amp; _projection_matrix, <span class="keyword">const</span> matrix4x4&amp; _inv_view_matrix, <span class="keyword">const</span> vector3&amp; _view_dir_x, <span class="keyword">const</span> vector3&amp; _view_dir_y, <span class="keyword">const</span> vector3&amp; _view_dir_z) {</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;        glEnable(GL_BLEND);</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;        glBlendFunci(alpha_buffer::colour_attachments::accumulation, GL_ONE, GL_ONE); <span class="comment">// Accumulation blend target.</span></div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;        glBlendFunci(alpha_buffer::colour_attachments::revealage, GL_ZERO, GL_ONE_MINUS_SRC_COLOR); <span class="comment">// Revealage blend target.</span></div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;        glEnable(GL_DEPTH_TEST); <span class="comment">// We want to depth test against opaque objects,</span></div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;        glDepthMask(GL_FALSE); <span class="comment">// but not transparent objects.</span></div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;        glDepthFunc(GL_LESS);</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160; </div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;        glViewport(0, 0, <a class="code" href="classmkr_1_1graphics__renderer.html#af195e60ae026f50df4fdf76b73c852f9">a_buff_</a>-&gt;width(), <a class="code" href="classmkr_1_1graphics__renderer.html#af195e60ae026f50df4fdf76b73c852f9">a_buff_</a>-&gt;height());</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160; </div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;        <a class="code" href="classmkr_1_1graphics__renderer.html#af195e60ae026f50df4fdf76b73c852f9">a_buff_</a>-&gt;bind();</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;        <a class="code" href="classmkr_1_1graphics__renderer.html#af195e60ae026f50df4fdf76b73c852f9">a_buff_</a>-&gt;set_draw_colour_attachment_all();</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;        <a class="code" href="classmkr_1_1graphics__renderer.html#af195e60ae026f50df4fdf76b73c852f9">a_buff_</a>-&gt;clear_colour(alpha_buffer::colour_attachments::accumulation, colour::black());</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;        <a class="code" href="classmkr_1_1graphics__renderer.html#af195e60ae026f50df4fdf76b73c852f9">a_buff_</a>-&gt;clear_colour(alpha_buffer::colour_attachments::revealage, colour{1.0f, 0.0f, 0.0f, 0.0f});</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;        <a class="code" href="classmkr_1_1graphics__renderer.html#af195e60ae026f50df4fdf76b73c852f9">a_buff_</a>-&gt;clear_depth_stencil();</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160; </div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;        <span class="comment">// Blit depth-stencil.</span></div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;        <a class="code" href="classmkr_1_1graphics__renderer.html#a901ae3acb341793861c91c306402b0d6">f_buff_</a>-&gt;blit_to(<a class="code" href="classmkr_1_1graphics__renderer.html#af195e60ae026f50df4fdf76b73c852f9">a_buff_</a>.get(), <span class="keyword">false</span>, <span class="keyword">true</span>, <span class="keyword">true</span>, 0, 0, <a class="code" href="classmkr_1_1graphics__renderer.html#a901ae3acb341793861c91c306402b0d6">f_buff_</a>-&gt;width(), <a class="code" href="classmkr_1_1graphics__renderer.html#a901ae3acb341793861c91c306402b0d6">f_buff_</a>-&gt;height(), 0, 0, <a class="code" href="classmkr_1_1graphics__renderer.html#af195e60ae026f50df4fdf76b73c852f9">a_buff_</a>-&gt;width(), <a class="code" href="classmkr_1_1graphics__renderer.html#af195e60ae026f50df4fdf76b73c852f9">a_buff_</a>-&gt;height());</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160; </div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;        <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; material_iter : <a class="code" href="classmkr_1_1graphics__renderer.html#aacb1c077166c9db226cbee3b901eee1d">transparent_meshes_</a>) {</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;            <span class="keyword">auto</span> material_ptr = material_iter.first;</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;            <span class="keyword">auto</span> shader = material_ptr-&gt;alpha_weight_shader_;</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;            shader-&gt;use();</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160; </div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;            <span class="comment">// Bind textures.</span></div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;            <span class="keywordflow">if</span> (material_ptr-&gt;texture_diffuse_) { material_ptr-&gt;texture_diffuse_-&gt;bind(<a class="code" href="namespacemkr.html#a3f278ec75926bdfd4b49d1fd23c704dfa279c221a440a6e199736a992a2e13873">texture_unit::texture_diffuse</a>); }</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;            <span class="keywordflow">if</span> (material_ptr-&gt;texture_normal_) { material_ptr-&gt;texture_normal_-&gt;bind(<a class="code" href="namespacemkr.html#a3f278ec75926bdfd4b49d1fd23c704dfa2e6f41bb29037dc80504b943a03a37f5">texture_unit::texture_normal</a>); }</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;            <span class="keywordflow">if</span> (material_ptr-&gt;texture_specular_) { material_ptr-&gt;texture_specular_-&gt;bind(<a class="code" href="namespacemkr.html#a3f278ec75926bdfd4b49d1fd23c704dfa77f77f76d87adf102db0c97761a32f89">texture_unit::texture_specular</a>); }</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;            <span class="keywordflow">if</span> (material_ptr-&gt;texture_displacement_) { material_ptr-&gt;texture_displacement_-&gt;bind(<a class="code" href="namespacemkr.html#a3f278ec75926bdfd4b49d1fd23c704dfa713a31f5dc6be65e75247060dc49742e">texture_unit::texture_displacement</a>); }</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160; </div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;            <span class="comment">// Bind shadow maps.</span></div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;            <span class="keyword">const</span> <span class="keyword">auto</span> num_lights = maths_util::min&lt;int32_t&gt;(<a class="code" href="classmkr_1_1graphics__renderer.html#abb759c34beb9aaecf69842a174b64ad0">lights_</a>.size(), <a class="code" href="classmkr_1_1lighting.html#a1d2c15e1eaa3c8162a4a6773a9be5d4e">lighting::max_lights</a>);</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;            <span class="keywordflow">for</span> (<span class="keyword">auto</span> i = 0; i &lt; num_lights; ++i) {</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="namespacemkr.html#a898cbea13b10a6143c2faf35f4a0fbc2ac895ec5b78e7a9170494460bc36e10a8">light_mode::point</a> == <a class="code" href="classmkr_1_1graphics__renderer.html#abb759c34beb9aaecf69842a174b64ad0">lights_</a>[i].light_.get_mode()) {</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;                    <a class="code" href="classmkr_1_1graphics__renderer.html#a3dbb1e5e1ad7620aaa5361aadb891637">scube_buff_</a>[i]-&gt;get_depth_stencil_attachment()-&gt;bind(<a class="code" href="namespacemkr.html#a3f278ec75926bdfd4b49d1fd23c704dfa56a127e30908390a1aa07e17d77be169">texture_unit::cubemap_shadows0</a> + i);</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;                    <a class="code" href="classmkr_1_1graphics__renderer.html#a59ae33da60e332c8a6de4ea65ed8937e">s2d_buff_</a>[i]-&gt;get_depth_stencil_attachment()-&gt;bind(<a class="code" href="namespacemkr.html#a3f278ec75926bdfd4b49d1fd23c704dfad0d43d452801153231699bb9e84733ac">texture_unit::texture_shadows0</a> + i);</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;                }</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;            }</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160; </div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;            <span class="comment">// Transform</span></div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;            shader-&gt;set_uniform(alpha_weight_shader::uniform::u_view_matrix, <span class="keyword">false</span>, _view_matrix);</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;            shader-&gt;set_uniform(alpha_weight_shader::uniform::u_projection_matrix, <span class="keyword">false</span>, _projection_matrix);</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;            shader-&gt;set_uniform(alpha_weight_shader::uniform::u_texture_offset, material_ptr-&gt;texture_offset_);</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;            shader-&gt;set_uniform(alpha_weight_shader::uniform::u_texture_scale, material_ptr-&gt;texture_scale_);</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160; </div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;            shader-&gt;set_uniform(alpha_weight_shader::uniform::u_inv_view_matrix, <span class="keyword">false</span>, _inv_view_matrix);</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160; </div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;            <span class="comment">// Material</span></div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;            shader-&gt;set_uniform(alpha_weight_shader::uniform::u_diffuse_colour, material_ptr-&gt;diffuse_colour_);</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;            shader-&gt;set_uniform(alpha_weight_shader::uniform::u_specular_colour, material_ptr-&gt;specular_colour_);</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;            shader-&gt;set_uniform(alpha_weight_shader::uniform::u_displacement_scale, material_ptr-&gt;displacement_scale_);</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160; </div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;            <span class="comment">// Textures</span></div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;            shader-&gt;set_uniform(alpha_weight_shader::uniform::u_has_texture_diffuse, material_ptr-&gt;texture_diffuse_ != <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;            shader-&gt;set_uniform(alpha_weight_shader::uniform::u_has_texture_normal, material_ptr-&gt;texture_normal_ != <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;            shader-&gt;set_uniform(alpha_weight_shader::uniform::u_has_texture_specular, material_ptr-&gt;texture_specular_ != <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;            shader-&gt;set_uniform(alpha_weight_shader::uniform::u_has_texture_displacement, material_ptr-&gt;texture_displacement_ != <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160; </div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;            <span class="comment">// Lights</span></div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;            shader-&gt;set_uniform(alpha_weight_shader::uniform::u_num_lights, num_lights);</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;            shader-&gt;set_uniform(alpha_weight_shader::uniform::u_ambient_light, <a class="code" href="classmkr_1_1lighting.html#a05fdf0bf39258c6d1bde9dde1d3a145d">lighting::ambient_light_</a>);</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160; </div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;            <span class="keywordflow">for</span> (<span class="keyword">auto</span> i = 0; i &lt; num_lights; ++i) {</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;                <span class="keyword">const</span> <span class="keyword">auto</span>&amp; t = <a class="code" href="classmkr_1_1graphics__renderer.html#abb759c34beb9aaecf69842a174b64ad0">lights_</a>[i].transform_;</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;                <span class="keyword">const</span> <span class="keyword">auto</span>&amp; l = <a class="code" href="classmkr_1_1graphics__renderer.html#abb759c34beb9aaecf69842a174b64ad0">lights_</a>[i].light_;</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160; </div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;                <span class="keyword">const</span> <span class="keyword">auto</span> light_pos_view = _view_matrix * t.position_; <span class="comment">// Light position in view space.</span></div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;                <span class="keyword">const</span> <span class="keyword">auto</span> light_dir_view = vector3{_view_dir_x.dot(t.forward_), _view_dir_y.dot(t.forward_), _view_dir_z.dot(t.forward_)}.normalised(); <span class="comment">// Light direction in view space.</span></div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160; </div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;                shader-&gt;set_uniform(i + alpha_weight_shader::uniform::u_light_mode0, l.get_mode());</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;                shader-&gt;set_uniform(i + alpha_weight_shader::uniform::u_light_power0, l.get_power());</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;                shader-&gt;set_uniform(i + alpha_weight_shader::uniform::u_light_colour0, l.get_colour());</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160; </div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;                shader-&gt;set_uniform(i + alpha_weight_shader::uniform::u_light_attenuation_constant0, l.get_attenuation_constant());</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;                shader-&gt;set_uniform(i + alpha_weight_shader::uniform::u_light_attenuation_linear0, l.get_attenuation_linear());</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;                shader-&gt;set_uniform(i + alpha_weight_shader::uniform::u_light_attenuation_quadratic0, l.get_attenuation_quadratic());</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160; </div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;                shader-&gt;set_uniform(i + alpha_weight_shader::uniform::u_light_spotlight_inner_cosine0, l.get_spotlight_inner_consine());</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;                shader-&gt;set_uniform(i + alpha_weight_shader::uniform::u_light_spotlight_outer_cosine0, l.get_spotlight_outer_consine());</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160; </div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;                shader-&gt;set_uniform(i + alpha_weight_shader::uniform::u_light_position0, light_pos_view);</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;                shader-&gt;set_uniform(i + alpha_weight_shader::uniform::u_light_direction0, light_dir_view);</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160; </div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;                shader-&gt;set_uniform(i + alpha_weight_shader::uniform::u_light_shadow_distance0, l.get_shadow_distance());</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;                shader-&gt;set_uniform(i + alpha_weight_shader::uniform::u_light_view_projection_matrix0, <span class="keyword">false</span>, <a class="code" href="classmkr_1_1graphics__renderer.html#a3399e8c52b940298b171e96da149ba0d">light_view_projection_matrix_</a>[i]);</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;            }</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160; </div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;            <span class="comment">// Draw to screen.</span></div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;            <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; mesh_iter : material_iter.second) {</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;                <span class="keyword">auto</span> mesh_ptr = mesh_iter.first;</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;                <span class="keyword">auto</span>&amp; model_matrices = mesh_iter.second;</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160; </div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;                std::vector&lt;mesh_instance_data&gt; batch;</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;                <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; model_matrix : model_matrices) {</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;                    <span class="keyword">const</span> <span class="keyword">auto</span> model_view_inverse = matrix_util::inverse_matrix(_view_matrix * model_matrix).value_or(matrix4x4::identity());</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;                    <span class="keyword">const</span> <span class="keyword">auto</span> normal_matrix = matrix_util::minor_matrix(model_view_inverse.transposed(), 3, 3);</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;                    batch.push_back({model_matrix, normal_matrix});</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;                }</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160; </div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;                mesh_ptr-&gt;bind();</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;                mesh_ptr-&gt;set_instance_data(batch);</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;                glDrawElementsInstanced(GL_TRIANGLES, mesh_ptr-&gt;num_indices(), GL_UNSIGNED_INT, 0, model_matrices.size());</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;            }</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;        }</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;    }</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160; </div>
<div class="line"><a name="l00709"></a><span class="lineno"><a class="line" href="classmkr_1_1graphics__renderer.html#a937769fc36ea98e5c5a68bba42798587">  709</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classmkr_1_1graphics__renderer.html#a937769fc36ea98e5c5a68bba42798587">graphics_renderer::alpha_blend_pass</a>(<span class="keyword">const</span> matrix4x4&amp; _view_matrix, <span class="keyword">const</span> matrix4x4&amp; _projection_matrix) {</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;        glEnable(GL_BLEND);</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;        glBlendFunc(GL_ONE_MINUS_SRC_ALPHA, GL_SRC_ALPHA);</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;        glEnable(GL_DEPTH_TEST);</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;        glDepthMask(GL_TRUE);</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;        glDepthFunc(GL_LESS);</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160; </div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;        glViewport(0, 0, <a class="code" href="classmkr_1_1graphics__renderer.html#a901ae3acb341793861c91c306402b0d6">f_buff_</a>-&gt;width(), <a class="code" href="classmkr_1_1graphics__renderer.html#a901ae3acb341793861c91c306402b0d6">f_buff_</a>-&gt;height());</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160; </div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;        <a class="code" href="classmkr_1_1graphics__renderer.html#a901ae3acb341793861c91c306402b0d6">f_buff_</a>-&gt;bind();</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;        <a class="code" href="classmkr_1_1graphics__renderer.html#a901ae3acb341793861c91c306402b0d6">f_buff_</a>-&gt;set_draw_colour_attachment_all();</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160; </div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;        <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; material_iter : <a class="code" href="classmkr_1_1graphics__renderer.html#aacb1c077166c9db226cbee3b901eee1d">transparent_meshes_</a>) {</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;            <span class="keyword">auto</span> material_ptr = material_iter.first;</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;            <span class="keyword">auto</span> shader = material_ptr-&gt;alpha_blend_shader_;</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;            shader-&gt;use();</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160; </div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;            <span class="comment">// Bind textures.</span></div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;            <a class="code" href="classmkr_1_1graphics__renderer.html#af195e60ae026f50df4fdf76b73c852f9">a_buff_</a>-&gt;get_colour_attachment(alpha_buffer::colour_attachments::accumulation)-&gt;bind(<a class="code" href="namespacemkr.html#a3f278ec75926bdfd4b49d1fd23c704dfaed3cb019fa94748c11130ff1ca0b8a11">texture_unit::texture_accumulation</a>);</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;            <a class="code" href="classmkr_1_1graphics__renderer.html#af195e60ae026f50df4fdf76b73c852f9">a_buff_</a>-&gt;get_colour_attachment(alpha_buffer::colour_attachments::revealage)-&gt;bind(<a class="code" href="namespacemkr.html#a3f278ec75926bdfd4b49d1fd23c704dfaf598b0422072c5d9d217f1cfcdb7a479">texture_unit::texture_revealage</a>);</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160; </div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;            <span class="comment">// Transform</span></div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;            shader-&gt;set_uniform(alpha_blend_shader::uniform::u_view_matrix, <span class="keyword">false</span>, _view_matrix);</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;            shader-&gt;set_uniform(alpha_blend_shader::uniform::u_projection_matrix, <span class="keyword">false</span>, _projection_matrix);</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160; </div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;            <span class="comment">// Draw to screen.</span></div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;            <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; mesh_iter : material_iter.second) {</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;                <span class="keyword">auto</span> mesh_ptr = mesh_iter.first;</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;                <span class="keyword">auto</span>&amp; model_matrices = mesh_iter.second;</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160; </div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;                std::vector&lt;mesh_instance_data&gt; batch;</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;                <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; model_matrix : model_matrices) {</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;                    <span class="keyword">const</span> <span class="keyword">auto</span> model_view_inverse = matrix_util::inverse_matrix(_view_matrix * model_matrix).value_or(matrix4x4::identity());</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;                    <span class="keyword">const</span> <span class="keyword">auto</span> normal_matrix = matrix_util::minor_matrix(model_view_inverse.transposed(), 3, 3);</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;                    batch.push_back({model_matrix, normal_matrix});</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;                }</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160; </div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;                mesh_ptr-&gt;bind();</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;                mesh_ptr-&gt;set_instance_data(batch);</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;                glDrawElementsInstanced(GL_TRIANGLES, mesh_ptr-&gt;num_indices(), GL_UNSIGNED_INT, 0, model_matrices.size());</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;            }</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;        }</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;    }</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160; </div>
<div class="line"><a name="l00753"></a><span class="lineno"><a class="line" href="classmkr_1_1graphics__renderer.html#af2ead439d01fcef7f72eae69e3242d5b">  753</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classmkr_1_1graphics__renderer.html#af2ead439d01fcef7f72eae69e3242d5b">graphics_renderer::skybox_pass</a>(<span class="keyword">const</span> matrix4x4&amp; _view_matrix, <span class="keyword">const</span> matrix4x4&amp; _projection_matrix, <span class="keyword">const</span> <a class="code" href="classmkr_1_1skybox.html">skybox</a>* _skybox) {</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;        <span class="keywordflow">if</span> (!_skybox || !_skybox-&gt;<a class="code" href="classmkr_1_1skybox.html#a1000d3b9dd0012fc18c6f0ea77c07dde">shader_</a>) { <span class="keywordflow">return</span>; }</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160; </div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;        glDisable(GL_BLEND);</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;        glEnable(GL_DEPTH_TEST);</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;        glDepthMask(GL_FALSE); <span class="comment">// Do not write to the depth buffer.</span></div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;        glDepthFunc(GL_LEQUAL); <span class="comment">// We&#39;ll set our depth to 1 in the fragment shader.</span></div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;        glViewport(0, 0, <a class="code" href="classmkr_1_1graphics__renderer.html#a901ae3acb341793861c91c306402b0d6">f_buff_</a>-&gt;width(), <a class="code" href="classmkr_1_1graphics__renderer.html#a901ae3acb341793861c91c306402b0d6">f_buff_</a>-&gt;height());</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160; </div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;        <span class="comment">/* Even though the skybox shader only writes to one colour attachment, we have to disable writing to the other colour attachments, otherwise they will have some undefined values written to them.</span></div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;<span class="comment">           As long as a colour attachment to set to be drawn to it, some value will be written to it no matter what, even if the shader does not specify.</span></div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;<span class="comment">           For the case of my computer, it will cause the values in colour_attachments::colour to also be written to the other colour attachments.</span></div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;<span class="comment">           [https://stackoverflow.com/questions/39545966/opengl-3-0-framebuffer-outputting-to-attachments-without-me-specifying] */</span></div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;        <a class="code" href="classmkr_1_1graphics__renderer.html#a901ae3acb341793861c91c306402b0d6">f_buff_</a>-&gt;bind();</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;        <a class="code" href="classmkr_1_1graphics__renderer.html#a901ae3acb341793861c91c306402b0d6">f_buff_</a>-&gt;set_draw_colour_attachment(forward_buffer::colour_attachments::colour);</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160; </div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;        <span class="keyword">auto</span> shader = _skybox-&gt;<a class="code" href="classmkr_1_1skybox.html#a1000d3b9dd0012fc18c6f0ea77c07dde">shader_</a>;</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;        shader-&gt;<a class="code" href="classmkr_1_1shader__program.html#a718cfdf922d5d469812bbff3a4738221">use</a>();</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160; </div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;        <span class="keywordflow">if</span> (_skybox-&gt;<a class="code" href="classmkr_1_1skybox.html#a01f8dd4fd3ff10473536bd7ead1cb4d5">texture_</a>) { _skybox-&gt;<a class="code" href="classmkr_1_1skybox.html#a01f8dd4fd3ff10473536bd7ead1cb4d5">texture_</a>-&gt;<a class="code" href="classmkr_1_1texture.html#a3aa55965a01682c06549d5d819962983">bind</a>(<a class="code" href="namespacemkr.html#a3f278ec75926bdfd4b49d1fd23c704dfa3e73636b1d3567f3e4554e27f48c2e4c">texture_unit::texture_skybox</a>); }</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160; </div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;        shader-&gt;set_uniform(skybox_shader::uniform::u_view_matrix, <span class="keyword">false</span>, _view_matrix);</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;        shader-&gt;set_uniform(skybox_shader::uniform::u_projection_matrix, <span class="keyword">false</span>, _projection_matrix);</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;        shader-&gt;set_uniform(skybox_shader::uniform::u_colour, _skybox-&gt;<a class="code" href="classmkr_1_1skybox.html#a0f3f77ded1dacf0a0f6e116c9ce08a9d">colour_</a>);</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;        shader-&gt;set_uniform(skybox_shader::uniform::u_texture_skybox_enabled, _skybox-&gt;<a class="code" href="classmkr_1_1skybox.html#a01f8dd4fd3ff10473536bd7ead1cb4d5">texture_</a> != <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160; </div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;        <a class="code" href="classmkr_1_1graphics__renderer.html#a85cf3d5b1696d91c74afda9703abf354">skybox_cube_</a>-&gt;bind();</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;        <a class="code" href="classmkr_1_1graphics__renderer.html#a85cf3d5b1696d91c74afda9703abf354">skybox_cube_</a>-&gt;set_instance_data({{matrix4x4::identity(), matrix3x3::identity()}});</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;        glDrawElementsInstanced(GL_TRIANGLES, <a class="code" href="classmkr_1_1graphics__renderer.html#a85cf3d5b1696d91c74afda9703abf354">skybox_cube_</a>-&gt;num_indices(), GL_UNSIGNED_INT, 0, 1);</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;    }</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160; </div>
<div class="line"><a name="l00784"></a><span class="lineno"><a class="line" href="classmkr_1_1graphics__renderer.html#aa286b25bfbff8d5a21670ddff1807350">  784</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classmkr_1_1graphics__renderer.html#aa286b25bfbff8d5a21670ddff1807350">graphics_renderer::submit_camera</a>(<span class="keyword">const</span> <a class="code" href="structmkr_1_1local__to__world.html">local_to_world</a>&amp; _transform, <span class="keyword">const</span> <a class="code" href="structmkr_1_1camera.html">camera</a>&amp; _camera) {</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;        <a class="code" href="classmkr_1_1graphics__renderer.html#a4ef270cde6f2290dc4fb80ebaa82a0bf">cameras_</a>.push({_transform, _camera});</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;    }</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160; </div>
<div class="line"><a name="l00788"></a><span class="lineno"><a class="line" href="classmkr_1_1graphics__renderer.html#a626e372cdb3341435d730b68543f128f">  788</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classmkr_1_1graphics__renderer.html#a626e372cdb3341435d730b68543f128f">graphics_renderer::submit_light</a>(<span class="keyword">const</span> <a class="code" href="structmkr_1_1local__to__world.html">local_to_world</a>&amp; _transform, <span class="keyword">const</span> <a class="code" href="classmkr_1_1light.html">light</a>&amp; _light) {</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;        <a class="code" href="classmkr_1_1graphics__renderer.html#abb759c34beb9aaecf69842a174b64ad0">lights_</a>.push_back({_transform, _light});</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;    }</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160; </div>
<div class="line"><a name="l00792"></a><span class="lineno"><a class="line" href="classmkr_1_1graphics__renderer.html#a18eeced7e3c8922e1bac6c0bac1f6e64">  792</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classmkr_1_1graphics__renderer.html#a18eeced7e3c8922e1bac6c0bac1f6e64">graphics_renderer::submit_mesh</a>(<span class="keyword">const</span> <a class="code" href="structmkr_1_1local__to__world.html">local_to_world</a>&amp; _transform, <span class="keyword">const</span> <a class="code" href="structmkr_1_1render__mesh.html">render_mesh</a>&amp; _render_mesh) {</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;        <span class="keywordflow">if</span> (_render_mesh.<a class="code" href="structmkr_1_1render__mesh.html#a3dd72b49f1dd57fbe307bbddc359b894">material_</a> == <span class="keyword">nullptr</span> || _render_mesh.<a class="code" href="structmkr_1_1render__mesh.html#ab9d1be0feeb50be2713631c91cadc5ee">mesh_</a> == <span class="keyword">nullptr</span>) { <span class="keywordflow">return</span>; }</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;        <span class="keywordflow">switch</span> (_render_mesh.<a class="code" href="structmkr_1_1render__mesh.html#a3dd72b49f1dd57fbe307bbddc359b894">material_</a>-&gt;<a class="code" href="classmkr_1_1material.html#a847de8f959a0377a722a53812cae7f17">render_path_</a>) {</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="namespacemkr.html#ad08e11457fb92a01b7c2ed043292f8b9a43fff3df3fc0b3417c86dc3040fb2d86">render_path::deferred</a>:</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;                <a class="code" href="classmkr_1_1graphics__renderer.html#a43a2edd7a4f1420853e119ca87e3c084">deferred_meshes_</a>[_render_mesh.<a class="code" href="structmkr_1_1render__mesh.html#a3dd72b49f1dd57fbe307bbddc359b894">material_</a>][_render_mesh.<a class="code" href="structmkr_1_1render__mesh.html#ab9d1be0feeb50be2713631c91cadc5ee">mesh_</a>].push_back(_transform.<a class="code" href="structmkr_1_1local__to__world.html#a926202c619f33ca9ca9660b6ffb60174">transform_</a>);</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="namespacemkr.html#ad08e11457fb92a01b7c2ed043292f8b9a965dbaac085fc891bfbbd4f9d145bbc8">render_path::forward</a>:</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;                <a class="code" href="classmkr_1_1graphics__renderer.html#a59742a9742830bf3076ea959fc754ef2">forward_meshes_</a>[_render_mesh.<a class="code" href="structmkr_1_1render__mesh.html#a3dd72b49f1dd57fbe307bbddc359b894">material_</a>][_render_mesh.<a class="code" href="structmkr_1_1render__mesh.html#ab9d1be0feeb50be2713631c91cadc5ee">mesh_</a>].push_back(_transform.<a class="code" href="structmkr_1_1local__to__world.html#a926202c619f33ca9ca9660b6ffb60174">transform_</a>);</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="namespacemkr.html#ad08e11457fb92a01b7c2ed043292f8b9a5e96bf62b9b2c18fdb65564b4a18fd1f">render_path::transparent</a>:</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;                <a class="code" href="classmkr_1_1graphics__renderer.html#aacb1c077166c9db226cbee3b901eee1d">transparent_meshes_</a>[_render_mesh.<a class="code" href="structmkr_1_1render__mesh.html#a3dd72b49f1dd57fbe307bbddc359b894">material_</a>][_render_mesh.<a class="code" href="structmkr_1_1render__mesh.html#ab9d1be0feeb50be2713631c91cadc5ee">mesh_</a>].push_back(_transform.<a class="code" href="structmkr_1_1local__to__world.html#a926202c619f33ca9ca9660b6ffb60174">transform_</a>);</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;            <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;        }</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;    }</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;} <span class="comment">// mkr</span></div>
<div class="ttc" id="aalpha__blend__shader_8h_html"><div class="ttname"><a href="alpha__blend__shader_8h.html">alpha_blend_shader.h</a></div></div>
<div class="ttc" id="aalpha__weight__shader_8h_html"><div class="ttname"><a href="alpha__weight__shader_8h.html">alpha_weight_shader.h</a></div></div>
<div class="ttc" id="aclassmkr_1_1framebuffer_html_a5e6c6bffac007288e732c099526e66ff"><div class="ttname"><a href="classmkr_1_1framebuffer.html#a5e6c6bffac007288e732c099526e66ff">mkr::framebuffer::height</a></div><div class="ttdeci">uint32_t height() const</div><div class="ttdef"><b>Definition:</b> <a href="framebuffer_8h_source.html#l00028">framebuffer.h:28</a></div></div>
<div class="ttc" id="aclassmkr_1_1framebuffer_html_a655ac6cb85a26d0ee4f842b098268b57"><div class="ttname"><a href="classmkr_1_1framebuffer.html#a655ac6cb85a26d0ee4f842b098268b57">mkr::framebuffer::width</a></div><div class="ttdeci">uint32_t width() const</div><div class="ttdef"><b>Definition:</b> <a href="framebuffer_8h_source.html#l00026">framebuffer.h:26</a></div></div>
<div class="ttc" id="aclassmkr_1_1framebuffer_html_aa0c848e4bbe22fbd7c9772fa86c9e244"><div class="ttname"><a href="classmkr_1_1framebuffer.html#aa0c848e4bbe22fbd7c9772fa86c9e244">mkr::framebuffer::bind</a></div><div class="ttdeci">void bind()</div><div class="ttdef"><b>Definition:</b> <a href="framebuffer_8cpp_source.html#l00024">framebuffer.cpp:24</a></div></div>
<div class="ttc" id="aclassmkr_1_1framebuffer_html_aaa795cc358720ae8a4d6c756952cc032"><div class="ttname"><a href="classmkr_1_1framebuffer.html#aaa795cc358720ae8a4d6c756952cc032">mkr::framebuffer::bind_default_buffer</a></div><div class="ttdeci">static void bind_default_buffer()</div><div class="ttdef"><b>Definition:</b> <a href="framebuffer_8h_source.html#l00056">framebuffer.h:56</a></div></div>
<div class="ttc" id="aclassmkr_1_1framebuffer_html_abec99a4f107c5a285082fa59ea3dab59"><div class="ttname"><a href="classmkr_1_1framebuffer.html#abec99a4f107c5a285082fa59ea3dab59">mkr::framebuffer::clear_default_depth_stencil</a></div><div class="ttdeci">static void clear_default_depth_stencil(float _depth=1.0f, int32_t _stencil=0)</div><div class="ttdef"><b>Definition:</b> <a href="framebuffer_8h_source.html#l00060">framebuffer.h:60</a></div></div>
<div class="ttc" id="aclassmkr_1_1framebuffer_html_ae4ed1d1cf196d0f5da5723b8b8b8c0ca"><div class="ttname"><a href="classmkr_1_1framebuffer.html#ae4ed1d1cf196d0f5da5723b8b8b8c0ca">mkr::framebuffer::clear_depth_stencil</a></div><div class="ttdeci">virtual void clear_depth_stencil(float _depth=1.0f, int32_t _stencil=0)</div><div class="ttdef"><b>Definition:</b> <a href="framebuffer_8cpp_source.html#l00063">framebuffer.cpp:63</a></div></div>
<div class="ttc" id="aclassmkr_1_1framebuffer_html_af2a2e110301c80169d7c5ff648b5de06"><div class="ttname"><a href="classmkr_1_1framebuffer.html#af2a2e110301c80169d7c5ff648b5de06">mkr::framebuffer::clear_default_buffer_colour</a></div><div class="ttdeci">static void clear_default_buffer_colour(const colour &amp;_colour=colour::black())</div><div class="ttdef"><b>Definition:</b> <a href="framebuffer_8h_source.html#l00058">framebuffer.h:58</a></div></div>
<div class="ttc" id="aclassmkr_1_1graphics__renderer_html_a03b093c17c37fada37b9ddda4fdfd027"><div class="ttname"><a href="classmkr_1_1graphics__renderer.html#a03b093c17c37fada37b9ddda4fdfd027">mkr::graphics_renderer::directional_shadow</a></div><div class="ttdeci">matrix4x4 directional_shadow(shadow_2d_buffer *_buffer, const local_to_world &amp;_light_trans, const light &amp;_light, const local_to_world &amp;_cam_trans, const camera &amp;_cam)</div><div class="ttdef"><b>Definition:</b> <a href="graphics__renderer_8cpp_source.html#l00287">graphics_renderer.cpp:287</a></div></div>
<div class="ttc" id="aclassmkr_1_1graphics__renderer_html_a12b13a3af206a9d6ef1c3aed35910b0b"><div class="ttname"><a href="classmkr_1_1graphics__renderer.html#a12b13a3af206a9d6ef1c3aed35910b0b">mkr::graphics_renderer::start</a></div><div class="ttdeci">void start()</div><div class="ttdef"><b>Definition:</b> <a href="graphics__renderer_8cpp_source.html#l00065">graphics_renderer.cpp:65</a></div></div>
<div class="ttc" id="aclassmkr_1_1graphics__renderer_html_a18eeced7e3c8922e1bac6c0bac1f6e64"><div class="ttname"><a href="classmkr_1_1graphics__renderer.html#a18eeced7e3c8922e1bac6c0bac1f6e64">mkr::graphics_renderer::submit_mesh</a></div><div class="ttdeci">void submit_mesh(const local_to_world &amp;_transform, const render_mesh &amp;_render_mesh)</div><div class="ttdef"><b>Definition:</b> <a href="graphics__renderer_8cpp_source.html#l00792">graphics_renderer.cpp:792</a></div></div>
<div class="ttc" id="aclassmkr_1_1graphics__renderer_html_a28c9b6891e064af8a13c42483e6310c9"><div class="ttname"><a href="classmkr_1_1graphics__renderer.html#a28c9b6891e064af8a13c42483e6310c9">mkr::graphics_renderer::point_shadow</a></div><div class="ttdeci">matrix4x4 point_shadow(shadow_cubemap_buffer *_buffer, const local_to_world &amp;_trans, const light &amp;_light)</div><div class="ttdef"><b>Definition:</b> <a href="graphics__renderer_8cpp_source.html#l00166">graphics_renderer.cpp:166</a></div></div>
<div class="ttc" id="aclassmkr_1_1graphics__renderer_html_a3399e8c52b940298b171e96da149ba0d"><div class="ttname"><a href="classmkr_1_1graphics__renderer.html#a3399e8c52b940298b171e96da149ba0d">mkr::graphics_renderer::light_view_projection_matrix_</a></div><div class="ttdeci">matrix4x4 light_view_projection_matrix_[lighting::max_lights]</div><div class="ttdef"><b>Definition:</b> <a href="graphics__renderer_8h_source.html#l00058">graphics_renderer.h:58</a></div></div>
<div class="ttc" id="aclassmkr_1_1graphics__renderer_html_a3dbb1e5e1ad7620aaa5361aadb891637"><div class="ttname"><a href="classmkr_1_1graphics__renderer.html#a3dbb1e5e1ad7620aaa5361aadb891637">mkr::graphics_renderer::scube_buff_</a></div><div class="ttdeci">std::unique_ptr&lt; shadow_cubemap_buffer &gt; scube_buff_[lighting::max_lights]</div><div class="ttdef"><b>Definition:</b> <a href="graphics__renderer_8h_source.html#l00049">graphics_renderer.h:49</a></div></div>
<div class="ttc" id="aclassmkr_1_1graphics__renderer_html_a43a2edd7a4f1420853e119ca87e3c084"><div class="ttname"><a href="classmkr_1_1graphics__renderer.html#a43a2edd7a4f1420853e119ca87e3c084">mkr::graphics_renderer::deferred_meshes_</a></div><div class="ttdeci">std::unordered_map&lt; material *, std::unordered_map&lt; mesh *, std::vector&lt; matrix4x4 &gt; &gt; &gt; deferred_meshes_</div><div class="ttdef"><b>Definition:</b> <a href="graphics__renderer_8h_source.html#l00071">graphics_renderer.h:71</a></div></div>
<div class="ttc" id="aclassmkr_1_1graphics__renderer_html_a45bd8744927b027b02c65dfe28a5aff3"><div class="ttname"><a href="classmkr_1_1graphics__renderer.html#a45bd8744927b027b02c65dfe28a5aff3">mkr::graphics_renderer::update</a></div><div class="ttdeci">void update()</div><div class="ttdef"><b>Definition:</b> <a href="graphics__renderer_8cpp_source.html#l00085">graphics_renderer.cpp:85</a></div></div>
<div class="ttc" id="aclassmkr_1_1graphics__renderer_html_a4cfea9b043d9434c6ff483f7b99d2d9c"><div class="ttname"><a href="classmkr_1_1graphics__renderer.html#a4cfea9b043d9434c6ff483f7b99d2d9c">mkr::graphics_renderer::alpha_weight_pass</a></div><div class="ttdeci">void alpha_weight_pass(const matrix4x4 &amp;_view_matrix, const matrix4x4 &amp;_projection_matrix, const matrix4x4 &amp;_inv_view_matrix, const vector3 &amp;_view_dir_x, const vector3 &amp;_view_dir_y, const vector3 &amp;_view_dir_z)</div><div class="ttdef"><b>Definition:</b> <a href="graphics__renderer_8cpp_source.html#l00602">graphics_renderer.cpp:602</a></div></div>
<div class="ttc" id="aclassmkr_1_1graphics__renderer_html_a4ef270cde6f2290dc4fb80ebaa82a0bf"><div class="ttname"><a href="classmkr_1_1graphics__renderer.html#a4ef270cde6f2290dc4fb80ebaa82a0bf">mkr::graphics_renderer::cameras_</a></div><div class="ttdeci">std::priority_queue&lt; camera_data &gt; cameras_</div><div class="ttdef"><b>Definition:</b> <a href="graphics__renderer_8h_source.html#l00065">graphics_renderer.h:65</a></div></div>
<div class="ttc" id="aclassmkr_1_1graphics__renderer_html_a50b03b55fb625d4f702b45e07aa43c1a"><div class="ttname"><a href="classmkr_1_1graphics__renderer.html#a50b03b55fb625d4f702b45e07aa43c1a">mkr::graphics_renderer::init</a></div><div class="ttdeci">void init()</div><div class="ttdef"><b>Definition:</b> <a href="graphics__renderer_8cpp_source.html#l00019">graphics_renderer.cpp:19</a></div></div>
<div class="ttc" id="aclassmkr_1_1graphics__renderer_html_a57ff6c77dfaea39eeb2716d18fa8a18c"><div class="ttname"><a href="classmkr_1_1graphics__renderer.html#a57ff6c77dfaea39eeb2716d18fa8a18c">mkr::graphics_renderer::lighting_pass</a></div><div class="ttdeci">void lighting_pass(const matrix4x4 &amp;_view_matrix, const matrix4x4 &amp;_inv_view_matrix, const vector3 &amp;_view_dir_x, const vector3 &amp;_view_dir_y, const vector3 &amp;_view_dir_z)</div><div class="ttdef"><b>Definition:</b> <a href="graphics__renderer_8cpp_source.html#l00410">graphics_renderer.cpp:410</a></div></div>
<div class="ttc" id="aclassmkr_1_1graphics__renderer_html_a59742a9742830bf3076ea959fc754ef2"><div class="ttname"><a href="classmkr_1_1graphics__renderer.html#a59742a9742830bf3076ea959fc754ef2">mkr::graphics_renderer::forward_meshes_</a></div><div class="ttdeci">std::unordered_map&lt; material *, std::unordered_map&lt; mesh *, std::vector&lt; matrix4x4 &gt; &gt; &gt; forward_meshes_</div><div class="ttdef"><b>Definition:</b> <a href="graphics__renderer_8h_source.html#l00072">graphics_renderer.h:72</a></div></div>
<div class="ttc" id="aclassmkr_1_1graphics__renderer_html_a59ae33da60e332c8a6de4ea65ed8937e"><div class="ttname"><a href="classmkr_1_1graphics__renderer.html#a59ae33da60e332c8a6de4ea65ed8937e">mkr::graphics_renderer::s2d_buff_</a></div><div class="ttdeci">std::unique_ptr&lt; shadow_2d_buffer &gt; s2d_buff_[lighting::max_lights]</div><div class="ttdef"><b>Definition:</b> <a href="graphics__renderer_8h_source.html#l00048">graphics_renderer.h:48</a></div></div>
<div class="ttc" id="aclassmkr_1_1graphics__renderer_html_a5a1d94db42b966794e8177cdf2515c48"><div class="ttname"><a href="classmkr_1_1graphics__renderer.html#a5a1d94db42b966794e8177cdf2515c48">mkr::graphics_renderer::screen_quad_</a></div><div class="ttdeci">std::unique_ptr&lt; mesh &gt; screen_quad_</div><div class="ttdef"><b>Definition:</b> <a href="graphics__renderer_8h_source.html#l00061">graphics_renderer.h:61</a></div></div>
<div class="ttc" id="aclassmkr_1_1graphics__renderer_html_a626e372cdb3341435d730b68543f128f"><div class="ttname"><a href="classmkr_1_1graphics__renderer.html#a626e372cdb3341435d730b68543f128f">mkr::graphics_renderer::submit_light</a></div><div class="ttdeci">void submit_light(const local_to_world &amp;_transform, const light &amp;_light)</div><div class="ttdef"><b>Definition:</b> <a href="graphics__renderer_8cpp_source.html#l00788">graphics_renderer.cpp:788</a></div></div>
<div class="ttc" id="aclassmkr_1_1graphics__renderer_html_a85cf3d5b1696d91c74afda9703abf354"><div class="ttname"><a href="classmkr_1_1graphics__renderer.html#a85cf3d5b1696d91c74afda9703abf354">mkr::graphics_renderer::skybox_cube_</a></div><div class="ttdeci">std::unique_ptr&lt; mesh &gt; skybox_cube_</div><div class="ttdef"><b>Definition:</b> <a href="graphics__renderer_8h_source.html#l00062">graphics_renderer.h:62</a></div></div>
<div class="ttc" id="aclassmkr_1_1graphics__renderer_html_a901ae3acb341793861c91c306402b0d6"><div class="ttname"><a href="classmkr_1_1graphics__renderer.html#a901ae3acb341793861c91c306402b0d6">mkr::graphics_renderer::f_buff_</a></div><div class="ttdeci">std::unique_ptr&lt; forward_buffer &gt; f_buff_</div><div class="ttdef"><b>Definition:</b> <a href="graphics__renderer_8h_source.html#l00054">graphics_renderer.h:54</a></div></div>
<div class="ttc" id="aclassmkr_1_1graphics__renderer_html_a937769fc36ea98e5c5a68bba42798587"><div class="ttname"><a href="classmkr_1_1graphics__renderer.html#a937769fc36ea98e5c5a68bba42798587">mkr::graphics_renderer::alpha_blend_pass</a></div><div class="ttdeci">void alpha_blend_pass(const matrix4x4 &amp;_view_matrix, const matrix4x4 &amp;_projection_matrix)</div><div class="ttdef"><b>Definition:</b> <a href="graphics__renderer_8cpp_source.html#l00709">graphics_renderer.cpp:709</a></div></div>
<div class="ttc" id="aclassmkr_1_1graphics__renderer_html_a99ec397776d7d22c2ad225d9c73e5e98"><div class="ttname"><a href="classmkr_1_1graphics__renderer.html#a99ec397776d7d22c2ad225d9c73e5e98">mkr::graphics_renderer::exit</a></div><div class="ttdeci">void exit()</div><div class="ttdef"><b>Definition:</b> <a href="graphics__renderer_8cpp_source.html#l00093">graphics_renderer.cpp:93</a></div></div>
<div class="ttc" id="aclassmkr_1_1graphics__renderer_html_a9bfd2cde07bcbf5414359b7411fb66de"><div class="ttname"><a href="classmkr_1_1graphics__renderer.html#a9bfd2cde07bcbf5414359b7411fb66de">mkr::graphics_renderer::render</a></div><div class="ttdeci">void render()</div><div class="ttdef"><b>Definition:</b> <a href="graphics__renderer_8cpp_source.html#l00097">graphics_renderer.cpp:97</a></div></div>
<div class="ttc" id="aclassmkr_1_1graphics__renderer_html_aa286b25bfbff8d5a21670ddff1807350"><div class="ttname"><a href="classmkr_1_1graphics__renderer.html#aa286b25bfbff8d5a21670ddff1807350">mkr::graphics_renderer::submit_camera</a></div><div class="ttdeci">void submit_camera(const local_to_world &amp;_transform, const camera &amp;_camera)</div><div class="ttdef"><b>Definition:</b> <a href="graphics__renderer_8cpp_source.html#l00784">graphics_renderer.cpp:784</a></div></div>
<div class="ttc" id="aclassmkr_1_1graphics__renderer_html_aa2de2e0108508425cf4a68f549e1d377"><div class="ttname"><a href="classmkr_1_1graphics__renderer.html#aa2de2e0108508425cf4a68f549e1d377">mkr::graphics_renderer::l_buff_</a></div><div class="ttdeci">std::unique_ptr&lt; lighting_buffer &gt; l_buff_</div><div class="ttdef"><b>Definition:</b> <a href="graphics__renderer_8h_source.html#l00052">graphics_renderer.h:52</a></div></div>
<div class="ttc" id="aclassmkr_1_1graphics__renderer_html_aab27889f37c8c7661c5ade22f1b88e0b"><div class="ttname"><a href="classmkr_1_1graphics__renderer.html#aab27889f37c8c7661c5ade22f1b88e0b">mkr::graphics_renderer::geometry_pass</a></div><div class="ttdeci">void geometry_pass(const matrix4x4 &amp;_view_matrix, const matrix4x4 &amp;_projection_matrix)</div><div class="ttdef"><b>Definition:</b> <a href="graphics__renderer_8cpp_source.html#l00351">graphics_renderer.cpp:351</a></div></div>
<div class="ttc" id="aclassmkr_1_1graphics__renderer_html_aacb1c077166c9db226cbee3b901eee1d"><div class="ttname"><a href="classmkr_1_1graphics__renderer.html#aacb1c077166c9db226cbee3b901eee1d">mkr::graphics_renderer::transparent_meshes_</a></div><div class="ttdeci">std::unordered_map&lt; material *, std::unordered_map&lt; mesh *, std::vector&lt; matrix4x4 &gt; &gt; &gt; transparent_meshes_</div><div class="ttdef"><b>Definition:</b> <a href="graphics__renderer_8h_source.html#l00073">graphics_renderer.h:73</a></div></div>
<div class="ttc" id="aclassmkr_1_1graphics__renderer_html_abb759c34beb9aaecf69842a174b64ad0"><div class="ttname"><a href="classmkr_1_1graphics__renderer.html#abb759c34beb9aaecf69842a174b64ad0">mkr::graphics_renderer::lights_</a></div><div class="ttdeci">std::vector&lt; light_data &gt; lights_</div><div class="ttdef"><b>Definition:</b> <a href="graphics__renderer_8h_source.html#l00068">graphics_renderer.h:68</a></div></div>
<div class="ttc" id="aclassmkr_1_1graphics__renderer_html_abbcbdce247815fedf2ee671e88192a34"><div class="ttname"><a href="classmkr_1_1graphics__renderer.html#abbcbdce247815fedf2ee671e88192a34">mkr::graphics_renderer::window_width_</a></div><div class="ttdeci">uint32_t window_width_</div><div class="ttdef"><b>Definition:</b> <a href="graphics__renderer_8h_source.html#l00044">graphics_renderer.h:44</a></div></div>
<div class="ttc" id="aclassmkr_1_1graphics__renderer_html_ad5faef12b92a2717febc17b9cfe700b7"><div class="ttname"><a href="classmkr_1_1graphics__renderer.html#ad5faef12b92a2717febc17b9cfe700b7">mkr::graphics_renderer::spot_shadow</a></div><div class="ttdeci">matrix4x4 spot_shadow(shadow_2d_buffer *_buffer, const local_to_world &amp;_trans, const light &amp;_light)</div><div class="ttdef"><b>Definition:</b> <a href="graphics__renderer_8cpp_source.html#l00234">graphics_renderer.cpp:234</a></div></div>
<div class="ttc" id="aclassmkr_1_1graphics__renderer_html_ad8e80c6c3a0fd1a804208f41c32b51f5"><div class="ttname"><a href="classmkr_1_1graphics__renderer.html#ad8e80c6c3a0fd1a804208f41c32b51f5">mkr::graphics_renderer::app_window_</a></div><div class="ttdeci">std::unique_ptr&lt; app_window &gt; app_window_</div><div class="ttdef"><b>Definition:</b> <a href="graphics__renderer_8h_source.html#l00043">graphics_renderer.h:43</a></div></div>
<div class="ttc" id="aclassmkr_1_1graphics__renderer_html_aea08e104db3efd807eb0a72f17fd7082"><div class="ttname"><a href="classmkr_1_1graphics__renderer.html#aea08e104db3efd807eb0a72f17fd7082">mkr::graphics_renderer::window_height_</a></div><div class="ttdeci">uint32_t window_height_</div><div class="ttdef"><b>Definition:</b> <a href="graphics__renderer_8h_source.html#l00045">graphics_renderer.h:45</a></div></div>
<div class="ttc" id="aclassmkr_1_1graphics__renderer_html_aeb05b71134e3b598496187bf4d659e78"><div class="ttname"><a href="classmkr_1_1graphics__renderer.html#aeb05b71134e3b598496187bf4d659e78">mkr::graphics_renderer::forward_pass</a></div><div class="ttdeci">void forward_pass(const matrix4x4 &amp;_view_matrix, const matrix4x4 &amp;_projection_matrix, const matrix4x4 &amp;_inv_view_matrix, const vector3 &amp;_view_dir_x, const vector3 &amp;_view_dir_y, const vector3 &amp;_view_dir_z)</div><div class="ttdef"><b>Definition:</b> <a href="graphics__renderer_8cpp_source.html#l00479">graphics_renderer.cpp:479</a></div></div>
<div class="ttc" id="aclassmkr_1_1graphics__renderer_html_af195e60ae026f50df4fdf76b73c852f9"><div class="ttname"><a href="classmkr_1_1graphics__renderer.html#af195e60ae026f50df4fdf76b73c852f9">mkr::graphics_renderer::a_buff_</a></div><div class="ttdeci">std::unique_ptr&lt; alpha_buffer &gt; a_buff_</div><div class="ttdef"><b>Definition:</b> <a href="graphics__renderer_8h_source.html#l00056">graphics_renderer.h:56</a></div></div>
<div class="ttc" id="aclassmkr_1_1graphics__renderer_html_af2ead439d01fcef7f72eae69e3242d5b"><div class="ttname"><a href="classmkr_1_1graphics__renderer.html#af2ead439d01fcef7f72eae69e3242d5b">mkr::graphics_renderer::skybox_pass</a></div><div class="ttdeci">void skybox_pass(const matrix4x4 &amp;_view_matrix, const matrix4x4 &amp;_projection_matrix, const skybox *_skybox)</div><div class="ttdef"><b>Definition:</b> <a href="graphics__renderer_8cpp_source.html#l00753">graphics_renderer.cpp:753</a></div></div>
<div class="ttc" id="aclassmkr_1_1graphics__renderer_html_afa7c11f1aedc94b816a01e5ed5affeb2"><div class="ttname"><a href="classmkr_1_1graphics__renderer.html#afa7c11f1aedc94b816a01e5ed5affeb2">mkr::graphics_renderer::g_buff_</a></div><div class="ttdeci">std::unique_ptr&lt; geometry_buffer &gt; g_buff_</div><div class="ttdef"><b>Definition:</b> <a href="graphics__renderer_8h_source.html#l00051">graphics_renderer.h:51</a></div></div>
<div class="ttc" id="aclassmkr_1_1light_html"><div class="ttname"><a href="classmkr_1_1light.html">mkr::light</a></div><div class="ttdef"><b>Definition:</b> <a href="light_8h_source.html#l00013">light.h:13</a></div></div>
<div class="ttc" id="aclassmkr_1_1light_html_a2cb6e41279292e9fe1f068408280b191"><div class="ttname"><a href="classmkr_1_1light.html#a2cb6e41279292e9fe1f068408280b191">mkr::light::get_mode</a></div><div class="ttdeci">light_mode get_mode() const</div><div class="ttdef"><b>Definition:</b> <a href="light_8h_source.html#l00033">light.h:33</a></div></div>
<div class="ttc" id="aclassmkr_1_1light_html_a7d83df0332d070c5026e4356d201909e"><div class="ttname"><a href="classmkr_1_1light.html#a7d83df0332d070c5026e4356d201909e">mkr::light::get_shadow_distance</a></div><div class="ttdeci">float get_shadow_distance() const</div><div class="ttdef"><b>Definition:</b> <a href="light_8h_source.html#l00069">light.h:69</a></div></div>
<div class="ttc" id="aclassmkr_1_1light_html_ac6203bb21d92dffdb70f1102e4958571"><div class="ttname"><a href="classmkr_1_1light.html#ac6203bb21d92dffdb70f1102e4958571">mkr::light::get_spotlight_outer_angle</a></div><div class="ttdeci">float get_spotlight_outer_angle() const</div><div class="ttdef"><b>Definition:</b> <a href="light_8h_source.html#l00065">light.h:65</a></div></div>
<div class="ttc" id="aclassmkr_1_1lighting_html_a05fdf0bf39258c6d1bde9dde1d3a145d"><div class="ttname"><a href="classmkr_1_1lighting.html#a05fdf0bf39258c6d1bde9dde1d3a145d">mkr::lighting::ambient_light_</a></div><div class="ttdeci">static colour ambient_light_</div><div class="ttdef"><b>Definition:</b> <a href="lighting_8h_source.html#l00013">lighting.h:13</a></div></div>
<div class="ttc" id="aclassmkr_1_1lighting_html_a1d2c15e1eaa3c8162a4a6773a9be5d4e"><div class="ttname"><a href="classmkr_1_1lighting.html#a1d2c15e1eaa3c8162a4a6773a9be5d4e">mkr::lighting::max_lights</a></div><div class="ttdeci">static constexpr uint32_t max_lights</div><div class="ttdef"><b>Definition:</b> <a href="lighting_8h_source.html#l00011">lighting.h:11</a></div></div>
<div class="ttc" id="aclassmkr_1_1material_html_a3c8c14e67e7c89f6cf7ae53b529ab632"><div class="ttname"><a href="classmkr_1_1material.html#a3c8c14e67e7c89f6cf7ae53b529ab632">mkr::material::shadow_shader_2d_</a></div><div class="ttdeci">static shader_program * shadow_shader_2d_</div><div class="ttdef"><b>Definition:</b> <a href="material_8h_source.html#l00019">material.h:19</a></div></div>
<div class="ttc" id="aclassmkr_1_1material_html_a61d1dd0c97915c693a1c1a284b748060"><div class="ttname"><a href="classmkr_1_1material.html#a61d1dd0c97915c693a1c1a284b748060">mkr::material::light_shader_</a></div><div class="ttdeci">static shader_program * light_shader_</div><div class="ttdef"><b>Definition:</b> <a href="material_8h_source.html#l00020">material.h:20</a></div></div>
<div class="ttc" id="aclassmkr_1_1material_html_a847de8f959a0377a722a53812cae7f17"><div class="ttname"><a href="classmkr_1_1material.html#a847de8f959a0377a722a53812cae7f17">mkr::material::render_path_</a></div><div class="ttdeci">render_path render_path_</div><div class="ttdef"><b>Definition:</b> <a href="material_8h_source.html#l00015">material.h:15</a></div></div>
<div class="ttc" id="aclassmkr_1_1material_html_a94f19dea49b24b9477a696b80217d6c0"><div class="ttname"><a href="classmkr_1_1material.html#a94f19dea49b24b9477a696b80217d6c0">mkr::material::shadow_shader_cube_</a></div><div class="ttdeci">static shader_program * shadow_shader_cube_</div><div class="ttdef"><b>Definition:</b> <a href="material_8h_source.html#l00019">material.h:19</a></div></div>
<div class="ttc" id="aclassmkr_1_1material_html_ad2f7bdd6e381175da6aca200fb726c14"><div class="ttname"><a href="classmkr_1_1material.html#ad2f7bdd6e381175da6aca200fb726c14">mkr::material::geometry_shader_</a></div><div class="ttdeci">static shader_program * geometry_shader_</div><div class="ttdef"><b>Definition:</b> <a href="material_8h_source.html#l00020">material.h:20</a></div></div>
<div class="ttc" id="aclassmkr_1_1mesh__builder_html_a755d646cc88bda260d2766c18cad1c64"><div class="ttname"><a href="classmkr_1_1mesh__builder.html#a755d646cc88bda260d2766c18cad1c64">mkr::mesh_builder::make_screen_quad</a></div><div class="ttdeci">static std::unique_ptr&lt; mesh &gt; make_screen_quad(const std::string &amp;_name)</div><div class="ttdef"><b>Definition:</b> <a href="mesh__builder_8h_source.html#l00193">mesh_builder.h:193</a></div></div>
<div class="ttc" id="aclassmkr_1_1mesh__builder_html_ac38c3807cf8fc57625fb610cf7839f06"><div class="ttname"><a href="classmkr_1_1mesh__builder.html#ac38c3807cf8fc57625fb610cf7839f06">mkr::mesh_builder::make_skybox</a></div><div class="ttdeci">static std::unique_ptr&lt; mesh &gt; make_skybox(const std::string &amp;_name)</div><div class="ttdef"><b>Definition:</b> <a href="mesh__builder_8h_source.html#l00017">mesh_builder.h:17</a></div></div>
<div class="ttc" id="aclassmkr_1_1shader__program_html_a718cfdf922d5d469812bbff3a4738221"><div class="ttname"><a href="classmkr_1_1shader__program.html#a718cfdf922d5d469812bbff3a4738221">mkr::shader_program::use</a></div><div class="ttdeci">void use()</div><div class="ttdef"><b>Definition:</b> <a href="shader__program_8cpp_source.html#l00183">shader_program.cpp:183</a></div></div>
<div class="ttc" id="aclassmkr_1_1shadow__2d__buffer_html"><div class="ttname"><a href="classmkr_1_1shadow__2d__buffer.html">mkr::shadow_2d_buffer</a></div><div class="ttdef"><b>Definition:</b> <a href="shadow__2d__buffer_8h_source.html#l00007">shadow_2d_buffer.h:7</a></div></div>
<div class="ttc" id="aclassmkr_1_1shadow__bounds_html_acffd143c67c948584fe6e6d18b3d1e0a"><div class="ttname"><a href="classmkr_1_1shadow__bounds.html#acffd143c67c948584fe6e6d18b3d1e0a">mkr::shadow_bounds::get_perspective_bounds</a></div><div class="ttdeci">static bounding_box get_perspective_bounds(const matrix4x4 &amp;_light_view_matrix, const vector3 &amp;_cam_pos, const vector3 &amp;_cam_left, const vector3 &amp;_cam_up, const vector3 &amp;_cam_forward, float _near, float _far, float _aspect_ratio, float _fov)</div><div class="ttdef"><b>Definition:</b> <a href="shadow__bounds_8h_source.html#l00026">shadow_bounds.h:26</a></div></div>
<div class="ttc" id="aclassmkr_1_1shadow__cubemap__buffer_html"><div class="ttname"><a href="classmkr_1_1shadow__cubemap__buffer.html">mkr::shadow_cubemap_buffer</a></div><div class="ttdef"><b>Definition:</b> <a href="shadow__cubemap__buffer_8h_source.html#l00007">shadow_cubemap_buffer.h:7</a></div></div>
<div class="ttc" id="aclassmkr_1_1skybox_html"><div class="ttname"><a href="classmkr_1_1skybox.html">mkr::skybox</a></div><div class="ttdef"><b>Definition:</b> <a href="skybox_8h_source.html#l00009">skybox.h:9</a></div></div>
<div class="ttc" id="aclassmkr_1_1skybox_html_a01f8dd4fd3ff10473536bd7ead1cb4d5"><div class="ttname"><a href="classmkr_1_1skybox.html#a01f8dd4fd3ff10473536bd7ead1cb4d5">mkr::skybox::texture_</a></div><div class="ttdeci">cubemap * texture_</div><div class="ttdef"><b>Definition:</b> <a href="skybox_8h_source.html#l00012">skybox.h:12</a></div></div>
<div class="ttc" id="aclassmkr_1_1skybox_html_a0f3f77ded1dacf0a0f6e116c9ce08a9d"><div class="ttname"><a href="classmkr_1_1skybox.html#a0f3f77ded1dacf0a0f6e116c9ce08a9d">mkr::skybox::colour_</a></div><div class="ttdeci">colour colour_</div><div class="ttdef"><b>Definition:</b> <a href="skybox_8h_source.html#l00011">skybox.h:11</a></div></div>
<div class="ttc" id="aclassmkr_1_1skybox_html_a1000d3b9dd0012fc18c6f0ea77c07dde"><div class="ttname"><a href="classmkr_1_1skybox.html#a1000d3b9dd0012fc18c6f0ea77c07dde">mkr::skybox::shader_</a></div><div class="ttdeci">shader_program * shader_</div><div class="ttdef"><b>Definition:</b> <a href="skybox_8h_source.html#l00013">skybox.h:13</a></div></div>
<div class="ttc" id="aclassmkr_1_1texture_html_a3aa55965a01682c06549d5d819962983"><div class="ttname"><a href="classmkr_1_1texture.html#a3aa55965a01682c06549d5d819962983">mkr::texture::bind</a></div><div class="ttdeci">void bind(uint32_t _texture_unit)</div><div class="ttdef"><b>Definition:</b> <a href="texture_8h_source.html#l00037">texture.h:37</a></div></div>
<div class="ttc" id="aforward__shader_8h_html"><div class="ttname"><a href="forward__shader_8h.html">forward_shader.h</a></div></div>
<div class="ttc" id="ageometry__shader_8h_html"><div class="ttname"><a href="geometry__shader_8h.html">geometry_shader.h</a></div></div>
<div class="ttc" id="agraphics__renderer_8h_html"><div class="ttname"><a href="graphics__renderer_8h.html">graphics_renderer.h</a></div></div>
<div class="ttc" id="alighting__shader_8h_html"><div class="ttname"><a href="lighting__shader_8h.html">lighting_shader.h</a></div></div>
<div class="ttc" id="amesh__builder_8h_html"><div class="ttname"><a href="mesh__builder_8h.html">mesh_builder.h</a></div></div>
<div class="ttc" id="anamespacemkr_html"><div class="ttname"><a href="namespacemkr.html">mkr</a></div><div class="ttdef"><b>Definition:</b> <a href="application_8cpp_source.html#l00010">application.cpp:10</a></div></div>
<div class="ttc" id="anamespacemkr_html_a3f278ec75926bdfd4b49d1fd23c704dfa279c221a440a6e199736a992a2e13873"><div class="ttname"><a href="namespacemkr.html#a3f278ec75926bdfd4b49d1fd23c704dfa279c221a440a6e199736a992a2e13873">mkr::texture_diffuse</a></div><div class="ttdeci">@ texture_diffuse</div><div class="ttdef"><b>Definition:</b> <a href="texture__unit_8h_source.html#l00011">texture_unit.h:11</a></div></div>
<div class="ttc" id="anamespacemkr_html_a3f278ec75926bdfd4b49d1fd23c704dfa2e6f41bb29037dc80504b943a03a37f5"><div class="ttname"><a href="namespacemkr.html#a3f278ec75926bdfd4b49d1fd23c704dfa2e6f41bb29037dc80504b943a03a37f5">mkr::texture_normal</a></div><div class="ttdeci">@ texture_normal</div><div class="ttdef"><b>Definition:</b> <a href="texture__unit_8h_source.html#l00013">texture_unit.h:13</a></div></div>
<div class="ttc" id="anamespacemkr_html_a3f278ec75926bdfd4b49d1fd23c704dfa3e73636b1d3567f3e4554e27f48c2e4c"><div class="ttname"><a href="namespacemkr.html#a3f278ec75926bdfd4b49d1fd23c704dfa3e73636b1d3567f3e4554e27f48c2e4c">mkr::texture_skybox</a></div><div class="ttdeci">@ texture_skybox</div><div class="ttdef"><b>Definition:</b> <a href="texture__unit_8h_source.html#l00009">texture_unit.h:9</a></div></div>
<div class="ttc" id="anamespacemkr_html_a3f278ec75926bdfd4b49d1fd23c704dfa4779b46fb5d4803d6806d6d5b5faccc0"><div class="ttname"><a href="namespacemkr.html#a3f278ec75926bdfd4b49d1fd23c704dfa4779b46fb5d4803d6806d6d5b5faccc0">mkr::texture_position</a></div><div class="ttdeci">@ texture_position</div><div class="ttdef"><b>Definition:</b> <a href="texture__unit_8h_source.html#l00016">texture_unit.h:16</a></div></div>
<div class="ttc" id="anamespacemkr_html_a3f278ec75926bdfd4b49d1fd23c704dfa56a127e30908390a1aa07e17d77be169"><div class="ttname"><a href="namespacemkr.html#a3f278ec75926bdfd4b49d1fd23c704dfa56a127e30908390a1aa07e17d77be169">mkr::cubemap_shadows0</a></div><div class="ttdeci">@ cubemap_shadows0</div><div class="ttdef"><b>Definition:</b> <a href="texture__unit_8h_source.html#l00022">texture_unit.h:22</a></div></div>
<div class="ttc" id="anamespacemkr_html_a3f278ec75926bdfd4b49d1fd23c704dfa713a31f5dc6be65e75247060dc49742e"><div class="ttname"><a href="namespacemkr.html#a3f278ec75926bdfd4b49d1fd23c704dfa713a31f5dc6be65e75247060dc49742e">mkr::texture_displacement</a></div><div class="ttdeci">@ texture_displacement</div><div class="ttdef"><b>Definition:</b> <a href="texture__unit_8h_source.html#l00014">texture_unit.h:14</a></div></div>
<div class="ttc" id="anamespacemkr_html_a3f278ec75926bdfd4b49d1fd23c704dfa77f77f76d87adf102db0c97761a32f89"><div class="ttname"><a href="namespacemkr.html#a3f278ec75926bdfd4b49d1fd23c704dfa77f77f76d87adf102db0c97761a32f89">mkr::texture_specular</a></div><div class="ttdeci">@ texture_specular</div><div class="ttdef"><b>Definition:</b> <a href="texture__unit_8h_source.html#l00012">texture_unit.h:12</a></div></div>
<div class="ttc" id="anamespacemkr_html_a3f278ec75926bdfd4b49d1fd23c704dfad0d43d452801153231699bb9e84733ac"><div class="ttname"><a href="namespacemkr.html#a3f278ec75926bdfd4b49d1fd23c704dfad0d43d452801153231699bb9e84733ac">mkr::texture_shadows0</a></div><div class="ttdeci">@ texture_shadows0</div><div class="ttdef"><b>Definition:</b> <a href="texture__unit_8h_source.html#l00021">texture_unit.h:21</a></div></div>
<div class="ttc" id="anamespacemkr_html_a3f278ec75926bdfd4b49d1fd23c704dfaed3cb019fa94748c11130ff1ca0b8a11"><div class="ttname"><a href="namespacemkr.html#a3f278ec75926bdfd4b49d1fd23c704dfaed3cb019fa94748c11130ff1ca0b8a11">mkr::texture_accumulation</a></div><div class="ttdeci">@ texture_accumulation</div><div class="ttdef"><b>Definition:</b> <a href="texture__unit_8h_source.html#l00017">texture_unit.h:17</a></div></div>
<div class="ttc" id="anamespacemkr_html_a3f278ec75926bdfd4b49d1fd23c704dfaf598b0422072c5d9d217f1cfcdb7a479"><div class="ttname"><a href="namespacemkr.html#a3f278ec75926bdfd4b49d1fd23c704dfaf598b0422072c5d9d217f1cfcdb7a479">mkr::texture_revealage</a></div><div class="ttdeci">@ texture_revealage</div><div class="ttdef"><b>Definition:</b> <a href="texture__unit_8h_source.html#l00018">texture_unit.h:18</a></div></div>
<div class="ttc" id="anamespacemkr_html_a898cbea13b10a6143c2faf35f4a0fbc2a291534b609849353584a7552c8a44335"><div class="ttname"><a href="namespacemkr.html#a898cbea13b10a6143c2faf35f4a0fbc2a291534b609849353584a7552c8a44335">mkr::directional</a></div><div class="ttdeci">@ directional</div><div class="ttdef"><b>Definition:</b> <a href="light_8h_source.html#l00010">light.h:10</a></div></div>
<div class="ttc" id="anamespacemkr_html_a898cbea13b10a6143c2faf35f4a0fbc2a38e292da519d45e010738205cd347395"><div class="ttname"><a href="namespacemkr.html#a898cbea13b10a6143c2faf35f4a0fbc2a38e292da519d45e010738205cd347395">mkr::spot</a></div><div class="ttdeci">@ spot</div><div class="ttdef"><b>Definition:</b> <a href="light_8h_source.html#l00009">light.h:9</a></div></div>
<div class="ttc" id="anamespacemkr_html_a898cbea13b10a6143c2faf35f4a0fbc2ac895ec5b78e7a9170494460bc36e10a8"><div class="ttname"><a href="namespacemkr.html#a898cbea13b10a6143c2faf35f4a0fbc2ac895ec5b78e7a9170494460bc36e10a8">mkr::point</a></div><div class="ttdeci">@ point</div><div class="ttdef"><b>Definition:</b> <a href="light_8h_source.html#l00008">light.h:8</a></div></div>
<div class="ttc" id="anamespacemkr_html_a9655959a225d822da5e035327fbdb9bdadea58969a0734fca7a7a962adeb02da3"><div class="ttname"><a href="namespacemkr.html#a9655959a225d822da5e035327fbdb9bdadea58969a0734fca7a7a962adeb02da3">mkr::none</a></div><div class="ttdeci">@ none</div><div class="ttdef"><b>Definition:</b> <a href="app__window_8h_source.html#l00009">app_window.h:9</a></div></div>
<div class="ttc" id="anamespacemkr_html_aac2a3034ca6bac134bc3f4f42a31e076a75c6a0985bbb6ec81d99cbb52ff86c1d"><div class="ttname"><a href="namespacemkr.html#aac2a3034ca6bac134bc3f4f42a31e076a75c6a0985bbb6ec81d99cbb52ff86c1d">mkr::perspective</a></div><div class="ttdeci">@ perspective</div><div class="ttdef"><b>Definition:</b> <a href="camera_8h_source.html#l00010">camera.h:10</a></div></div>
<div class="ttc" id="anamespacemkr_html_abe8c29bfe2e55bc16a894b1120995935a09c06e9a8d2038500e21bae962a5abc7"><div class="ttname"><a href="namespacemkr.html#abe8c29bfe2e55bc16a894b1120995935a09c06e9a8d2038500e21bae962a5abc7">mkr::normal</a></div><div class="ttdeci">@ normal</div><div class="ttdef"><b>Definition:</b> <a href="vbo_8h_source.html#l00033">vbo.h:33</a></div></div>
<div class="ttc" id="anamespacemkr_html_abe8c29bfe2e55bc16a894b1120995935a8fe021f67e720dc9c296da06e976b14f"><div class="ttname"><a href="namespacemkr.html#abe8c29bfe2e55bc16a894b1120995935a8fe021f67e720dc9c296da06e976b14f">mkr::position</a></div><div class="ttdeci">@ position</div><div class="ttdef"><b>Definition:</b> <a href="vbo_8h_source.html#l00031">vbo.h:31</a></div></div>
<div class="ttc" id="anamespacemkr_html_ad08e11457fb92a01b7c2ed043292f8b9a43fff3df3fc0b3417c86dc3040fb2d86"><div class="ttname"><a href="namespacemkr.html#ad08e11457fb92a01b7c2ed043292f8b9a43fff3df3fc0b3417c86dc3040fb2d86">mkr::render_path::deferred</a></div><div class="ttdeci">@ deferred</div></div>
<div class="ttc" id="anamespacemkr_html_ad08e11457fb92a01b7c2ed043292f8b9a5e96bf62b9b2c18fdb65564b4a18fd1f"><div class="ttname"><a href="namespacemkr.html#ad08e11457fb92a01b7c2ed043292f8b9a5e96bf62b9b2c18fdb65564b4a18fd1f">mkr::render_path::transparent</a></div><div class="ttdeci">@ transparent</div></div>
<div class="ttc" id="anamespacemkr_html_ad08e11457fb92a01b7c2ed043292f8b9a965dbaac085fc891bfbbd4f9d145bbc8"><div class="ttname"><a href="namespacemkr.html#ad08e11457fb92a01b7c2ed043292f8b9a965dbaac085fc891bfbbd4f9d145bbc8">mkr::render_path::forward</a></div><div class="ttdeci">@ forward</div></div>
<div class="ttc" id="apost__proc__shader_8h_html"><div class="ttname"><a href="post__proc__shader_8h.html">post_proc_shader.h</a></div></div>
<div class="ttc" id="ashadow__2d__shader_8h_html"><div class="ttname"><a href="shadow__2d__shader_8h.html">shadow_2d_shader.h</a></div></div>
<div class="ttc" id="ashadow__bounds_8h_html"><div class="ttname"><a href="shadow__bounds_8h.html">shadow_bounds.h</a></div></div>
<div class="ttc" id="ashadow__cubemap__shader_8h_html"><div class="ttname"><a href="shadow__cubemap__shader_8h.html">shadow_cubemap_shader.h</a></div></div>
<div class="ttc" id="askybox__shader_8h_html"><div class="ttname"><a href="skybox__shader_8h.html">skybox_shader.h</a></div></div>
<div class="ttc" id="astructmkr_1_1camera_html"><div class="ttname"><a href="structmkr_1_1camera.html">mkr::camera</a></div><div class="ttdef"><b>Definition:</b> <a href="camera_8h_source.html#l00025">camera.h:25</a></div></div>
<div class="ttc" id="astructmkr_1_1camera_html_a290154c0ca1cc7d964bebcf2db164f91"><div class="ttname"><a href="structmkr_1_1camera.html#a290154c0ca1cc7d964bebcf2db164f91">mkr::camera::aspect_ratio_</a></div><div class="ttdeci">float aspect_ratio_</div><div class="ttdoc">Aspect ratio.</div><div class="ttdef"><b>Definition:</b> <a href="camera_8h_source.html#l00033">camera.h:33</a></div></div>
<div class="ttc" id="astructmkr_1_1camera_html_a85c8e9d8829c7a247624ec3f77bab5cf"><div class="ttname"><a href="structmkr_1_1camera.html#a85c8e9d8829c7a247624ec3f77bab5cf">mkr::camera::near_plane_</a></div><div class="ttdeci">float near_plane_</div><div class="ttdoc">Near plane.</div><div class="ttdef"><b>Definition:</b> <a href="camera_8h_source.html#l00029">camera.h:29</a></div></div>
<div class="ttc" id="astructmkr_1_1camera_html_ae45bc29cd21e447b21c4f247d11a1ff9"><div class="ttname"><a href="structmkr_1_1camera.html#ae45bc29cd21e447b21c4f247d11a1ff9">mkr::camera::fov_</a></div><div class="ttdeci">float fov_</div><div class="ttdoc">Perspective field of view (between 0.00001 to 179)</div><div class="ttdef"><b>Definition:</b> <a href="camera_8h_source.html#l00035">camera.h:35</a></div></div>
<div class="ttc" id="astructmkr_1_1local__to__world_html"><div class="ttname"><a href="structmkr_1_1local__to__world.html">mkr::local_to_world</a></div><div class="ttdef"><b>Definition:</b> <a href="local__to__world_8h_source.html#l00008">local_to_world.h:8</a></div></div>
<div class="ttc" id="astructmkr_1_1local__to__world_html_a4c7f168c7e467eb74df9b23a421abfd3"><div class="ttname"><a href="structmkr_1_1local__to__world.html#a4c7f168c7e467eb74df9b23a421abfd3">mkr::local_to_world::up_</a></div><div class="ttdeci">vector3 up_</div><div class="ttdef"><b>Definition:</b> <a href="local__to__world_8h_source.html#l00012">local_to_world.h:12</a></div></div>
<div class="ttc" id="astructmkr_1_1local__to__world_html_a56b092fda8cee1c4341665d05bc3c48b"><div class="ttname"><a href="structmkr_1_1local__to__world.html#a56b092fda8cee1c4341665d05bc3c48b">mkr::local_to_world::left_</a></div><div class="ttdeci">vector3 left_</div><div class="ttdef"><b>Definition:</b> <a href="local__to__world_8h_source.html#l00012">local_to_world.h:12</a></div></div>
<div class="ttc" id="astructmkr_1_1local__to__world_html_a926202c619f33ca9ca9660b6ffb60174"><div class="ttname"><a href="structmkr_1_1local__to__world.html#a926202c619f33ca9ca9660b6ffb60174">mkr::local_to_world::transform_</a></div><div class="ttdeci">matrix4x4 transform_</div><div class="ttdef"><b>Definition:</b> <a href="local__to__world_8h_source.html#l00009">local_to_world.h:9</a></div></div>
<div class="ttc" id="astructmkr_1_1local__to__world_html_aa25ce595f7bf081bd02ee2e1faa2bd63"><div class="ttname"><a href="structmkr_1_1local__to__world.html#aa25ce595f7bf081bd02ee2e1faa2bd63">mkr::local_to_world::position_</a></div><div class="ttdeci">vector3 position_</div><div class="ttdef"><b>Definition:</b> <a href="local__to__world_8h_source.html#l00011">local_to_world.h:11</a></div></div>
<div class="ttc" id="astructmkr_1_1local__to__world_html_acb399db3c95d0e625676a3bda7889e76"><div class="ttname"><a href="structmkr_1_1local__to__world.html#acb399db3c95d0e625676a3bda7889e76">mkr::local_to_world::forward_</a></div><div class="ttdeci">vector3 forward_</div><div class="ttdef"><b>Definition:</b> <a href="local__to__world_8h_source.html#l00012">local_to_world.h:12</a></div></div>
<div class="ttc" id="astructmkr_1_1render__mesh_html"><div class="ttname"><a href="structmkr_1_1render__mesh.html">mkr::render_mesh</a></div><div class="ttdef"><b>Definition:</b> <a href="render__mesh_8h_source.html#l00009">render_mesh.h:9</a></div></div>
<div class="ttc" id="astructmkr_1_1render__mesh_html_a3dd72b49f1dd57fbe307bbddc359b894"><div class="ttname"><a href="structmkr_1_1render__mesh.html#a3dd72b49f1dd57fbe307bbddc359b894">mkr::render_mesh::material_</a></div><div class="ttdeci">material * material_</div><div class="ttdef"><b>Definition:</b> <a href="render__mesh_8h_source.html#l00010">render_mesh.h:10</a></div></div>
<div class="ttc" id="astructmkr_1_1render__mesh_html_ab9d1be0feeb50be2713631c91cadc5ee"><div class="ttname"><a href="structmkr_1_1render__mesh.html#ab9d1be0feeb50be2713631c91cadc5ee">mkr::render_mesh::mesh_</a></div><div class="ttdeci">mesh * mesh_</div><div class="ttdef"><b>Definition:</b> <a href="render__mesh_8h_source.html#l00011">render_mesh.h:11</a></div></div>
<div class="ttc" id="atexture__unit_8h_html"><div class="ttname"><a href="texture__unit_8h.html">texture_unit.h</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
